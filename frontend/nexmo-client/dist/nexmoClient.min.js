!function(){return function r(e,t,n){function o(s,a){if(!t[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=t[s]={exports:{}};e[s][0].call(d.exports,function(t){return o(e[s][1][t]||t)},d,d.exports,r,e,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}}()({1:[function(e,t,r){const n=e("wildemitter"),i=e("loglevel").getLogger,o=e("./user"),s=e("./conversation"),a=e("./modules/nxmCall"),c=e("./handlers/sip_events"),u=e("./handlers/rtc_events"),d=e("./handlers/application_events"),p=e("./utils"),l=e("./pages/page_config"),h=e("./pages/conversations_page"),f=e("./nexmoClientError").NexmoClientError,m=e("./nexmoClientError").NexmoApiError;let g=null,v=null,y=null;class Application{constructor(e,t){this.log=i(this.constructor.name),this.session=e,this.conversations=new Map,this.synced_conversations_count=0,this.start_sync_time=0,this.stop_sync_time=0,this.calls=new Map,this._call_draft_list=new Map,this.pageConfig=new l((e.config||{}).conversations_page_config),this.conversations_page_last=null,g=new c(this),v=new u(this),y=new d(this),this.me=null,Object.assign(this,t),n.mixin(Application)}updateOrCreateConversation(e){const t=this.conversations.get(e.id);return t?(t._updateObjectInstance(e),this.conversations.set(e.id,t)):this.conversations.set(e.id,new s(this,e)),this.conversations.get(e.id)}_handleEvent(e){const t=e.body&&e.body.user&&e.body.user.user_id===this.me.id;e.type.startsWith("sip")?g._handleSipCallEvent(e):this.conversations.has(e.cid)?(e.type.startsWith("rtc")&&v._handleRtcEvent(e),this.conversations.get(e.cid)._handleEvent(e),"member:joined"!==e.type&&"member:invited"!==e.type||!t||this._handleApplicationEvent(e)):this.getConversation(e.cid).then(t=>{this.conversations.set(e.cid,t),t._handleEvent(e),this._handleApplicationEvent(e),e.type.startsWith("rtc")&&v._handleRtcEvent(e)}).catch(e=>{this.log.error(e)})}updateToken(e){return new Promise((t,r)=>{this.session.sendRequest({type:"session:update-token",body:{token:e}},n=>{"session:update-token:success"===n.type?(this.me&&this.session._updateTokenInStorage(e,this.me.name),t()):r(new m(n))})})}_handleApplicationEvent(e){const t=y.handleEvent(e);this.emit(t.type,this.conversations.get(e.cid).members.get(t.from),t)}inAppCall(e){return new Promise((t,r)=>{if(!e||!Array.isArray(e)||0===e.length)return r(new f("error:application:call:params"));const n=new a(this);return n.createCall(e).then(()=>(n.direction=n.CALL_DIRECTION.OUTBOUND,t(n))).catch(e=>{r(e)})})}callServer(e,t="phone"){return new Promise((r,n)=>{const i=new a(this);return i.direction=i.CALL_DIRECTION.OUTBOUND,i.createServerCall(e,t).then(({id:e})=>(i.knocking_id=e,this._call_draft_list.set(i.knocking_id,i),r(i)))})}newConversation(e={}){return new Promise((t,r)=>this.session.sendNetworkRequest({type:"POST",path:"conversations",data:e}).then(e=>{const r=new s(this,e);this.conversations.set(r.id,r),this.getConversation(r.id).then(e=>{t(e)})}).catch(e=>{r(new m(e))}))}newConversationAndJoin(e){return this.newConversation(e).then(e=>e.join().then(()=>e))}getConversation(e){return new Promise((t,r)=>this.session.sendNetworkRequest({type:"GET",path:`conversations/${e}`}).then(e=>{e.id=e.uuid,delete e.uuid;const r=this.updateOrCreateConversation(e);"full"===this.session.config.sync?r.getEvents().then(({items:e})=>{r.events=e,t(r)}):t(r)}).catch(e=>{r(new m(e))}))}getConversations(e={}){const t=`${this.session.config.nexmo_api_url}/beta2/users/${this.me.id}/conversations`;let r=0===Object.keys(e).length?this.pageConfig:new l(e);return new Promise((e,n)=>p.paginationRequest(t,r).then(t=>{t.application=this;const r=new h(t);this.conversations_page_last=r,e(r)}).catch(e=>n(new m(e))))}syncConversations(e){const t=Array.from(e.values()),r=t.length,n=new Date;this.start_sync_time="undefined"!=typeof window&&window.performance?window.performance.now():n.getTime();const i=()=>{this.synced_conversations_percentage=(this.synced_conversations_count/r*100).toFixed(2);const e={sync_progress:this.synced_conversations_percentage};if(this.emit("sync:progress",e),this.log.debug("Loading sync progress: "+this.synced_conversations_count+"/"+r+" - "+this.synced_conversations_percentage+"%"),this.synced_conversations_percentage>=100){const e=new Date;this.stop_sync_time="undefined"!=typeof window&&window.performance?window.performance.now():e.getTime(),this.log.info("Loaded conversations in "+(this.stop_sync_time-this.start_sync_time)+"ms")}this.synced_conversations_count<r&&(this.getConversation(t[this.synced_conversations_count].id).then(()=>{i()}),this.synced_conversations_count++,this.sync_progress_buffer++)};i()}getUser(e=this.me.id){return new Promise((t,r)=>this.session.sendNetworkRequest({type:"GET",path:`users/${e}`}).then(e=>{t(new o(this,e))}).catch(e=>{r(new m(e))}))}}t.exports=Application},{"./conversation":2,"./handlers/application_events":6,"./handlers/rtc_events":8,"./handlers/sip_events":9,"./modules/nxmCall":15,"./nexmoClientError":20,"./pages/conversations_page":22,"./pages/page_config":25,"./user":27,"./utils":28,loglevel:52,wildemitter:100}],2:[function(e,t,r){const n=e("wildemitter"),i=e("loglevel").getLogger,o=e("./member"),s=e("./events/nxmEvent"),a=e("./events/text_event"),c=e("./modules/media"),u=e("./handlers/conversation_events"),d=e("./nexmoClientError").NexmoClientError,p=e("./nexmoClientError").NexmoApiError,l=e("./utils"),h=e("./pages/page_config"),f=e("./pages/events_page");class Conversation{constructor(e,t){this.log=i(this.constructor.name),this.application=e,this.id=null,this.name=null,this.display_name=null,this.timestamp=null,this.members=new Map,this.events=new Map,this.sequence_number=0,this.is_video_conversation=!1,this.pageConfig=new h(((this.application.session||{}).config||{}).events_page_config),this.events_page_last=null,this.conversationEventHandler=new u(e,this),this.media=new c(this),this.me=null,this._updateObjectInstance(t),n.mixin(Conversation)}_updateObjectInstance(e){for(let t in e)switch(t){case"id":this.id=e.id;break;case"name":this.name=e.name;break;case"display_name":this.display_name=e.display_name;break;case"members":e.members.map(e=>{if(this.members.has(e.member_id))this.members.get(e.member_id)._normalise(e),e.user_id===this.application.me.id&&"LEFT"!==e.state&&(this.me=this.members.get(e.member_id),this.members.set(this.me.id,this.me));else{const t=new o(this,e);e.user_id===this.application.me.id&&"LEFT"!==e.state&&(this.me=t),this.members.set(t.id,t)}});break;case"timestamp":this.timestamp=e.timestamp;break;case"sequence_number":this.sequence_number=e.sequence_number;break;case"member_id":const r={id:e.member_id,state:e.state,user:this.application.me};if(this.members.has(e.member_id)){const t=this.members.get(e.member_id);Object.assign(t,r)}else{const e=new o(this,r);this.me=e,this.members.set(e.id,e)}break;case"properties":this.is_video_conversation=e.properties.video}}join(e){const t={},r=e=>(e?(e.user_id&&(t.user_id=e.user_id),e.user_name&&(t.user_name=e.user_name)):(this.me&&this.me.id&&"INVITED"===this.me.state&&(t.member_id=this.me.id),t.user_name=this.application.me.name,t.user_id=this.application.me.id),t);return new Promise((t,n)=>{let i=r(e);return i.action="join",i.channel={type:"app"},this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/members`,data:i}).then(e=>{const r=new o(this,e);return e.user_id===this.application.me.id&&(this.me=r),this.members.set(r.id,r),this.application.getConversation(this.id).then(()=>t(r)).catch(()=>(this.log.warn("Failed getting conversation after joining"),t(r)))}).catch(e=>{n(new p(e))})})}del(){return new Promise((e,t)=>this.application.session.sendNetworkRequest({type:"DELETE",path:`conversations/${this.id}`}).then(t=>{this.application.conversations.delete(this.id),e(t)}).catch(e=>{t(new p(e))}))}deleteEvent(e){return e.del()}invite(e){return e&&(e.id||e.user_name)?new Promise((t,r)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/members`,data:{action:"invite",user_id:e.id,user_name:e.user_name,member_id_inviting:this.me.id,media:e.media,channel:{from:{type:"app"},leg_ids:[],leg_settings:{},legs:[],to:{type:"app"},type:"app"}}}).then(e=>{const r=new o(this,e);this.members.set(r.id,r),t(r)}).catch(e=>{r(new p(e))})):Promise.reject(new d("error:invite:missing:params"))}inviteWithAudio(e){return e&&(e.id||e.user_name)?(e.media={audio_settings:{enabled:!0,muted:!1,earmuffed:!1}},this.invite(e)):Promise.reject(new d("error:invite:missing:params"))}leave(e){return this.me.kick(e)}sendText(e){return new Promise((t,r)=>{if(null!==this.me){const n={type:"text",cid:this.id,from:this.me.id,body:{text:e}};return this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:n}).then(({id:e,timestamp:r})=>{n.id=e,n.body.timestamp=r;const i=new a(this,n);t(i)}).catch(e=>{r(new p(e))})}r(new d("error:self"))})}sendCustomEvent({type:e,body:t}){return new Promise((r,n)=>{if(null===this.me)n(new d("error:self"));else{if(e&&"string"==typeof e&&!(e.length<1)){const i={type:`custom:${e}`,cid:this.id,from:this.me.id,body:t};return this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:i}).then(({id:e,timestamp:t})=>{i.id=e,i.timestamp=t;const n=new s(this,i);r(n)}).catch(e=>{n(new p(e))})}n(new d("error:custom-event:invalid"))}})}sendImage(e,t={quality_ratio:100,medium_size_ratio:50,thumbnail_size_ratio:30}){const r=new FormData;return r.append("file",e),r.append("quality_ratio",t.quality_ratio),r.append("medium_size_ratio",t.medium_size_ratio),r.append("thumbnail_size_ratio",t.thumbnail_size_ratio),l.networkRequest({type:"POST",url:this.application.session.config.ips_url,data:r}).then(e=>(e.upload.addEventListener("progress",e=>{e.lengthComputable&&this.log.debug("uploading image "+e.loaded+"/"+e.total)},!1),e.onreadystatechange=(()=>{4===e.readyState&&200===e.status&&this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:{type:"image",from:this.me.id,body:{representations:JSON.parse(e.responseText)}}}).then(t=>{this.log.info(e)}).catch(e=>{this.log.debug(new p(e))}),200!==e.status&&this.log.error(e)}),Promise.resolve(e)))}abortSendImage(e){return e instanceof XMLHttpRequest?e.abort():new d("error:invalid:param:type")}_typing(e){const t={activity:"on"===e?1:0},r={type:"text:typing:"+e,cid:this.id,from:this.me.id,body:t};return new Promise((t,n)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:r}).then(r=>{t(`text:typing:${e}:success`)}).catch(e=>{n(new p(e))}))}startTyping(){return this._typing("on")}stopTyping(){return this._typing("off")}getEvents(e={}){const t=`${this.application.session.config.nexmo_api_url}/beta2/conversations/${this.id}/events`;let r=0===Object.keys(e).length?this.pageConfig:new h(e);return new Promise((e,n)=>l.paginationRequest(t,r).then(t=>{t.application=this.application,t.conversation=this;const r=new f(t);this.events_page_last=r,e(r)}).catch(e=>n(new p(e))))}_handleEvent(e){if(e.type.startsWith("rtc"))return void this.emit(e.type,e);this.sequence_number++,e.from&&!this.members.has(e.from)&&this.members.set(e.from,new o(this,e)),e.body&&e.body.event_id&&"string"==typeof e.body.event_id&&(e.body.event_id=parseInt(e.body.event_id));const t=this.members.get(e.from);let r=this.conversationEventHandler.handleEvent(e);["text:typing:on","text:typing:off"].includes(e.type)||this.events.set(r.id,r),e.type.startsWith("custom:")?this.emit(r.type,t,r):this.emit(e.type,t,r)}}t.exports=Conversation},{"./events/nxmEvent":4,"./events/text_event":5,"./handlers/conversation_events":7,"./member":11,"./modules/media":14,"./nexmoClientError":20,"./pages/events_page":23,"./pages/page_config":25,"./utils":28,loglevel:52,wildemitter:100}],3:[function(e,t,r){const n=e("loglevel").getLogger,o=e("./nxmEvent"),s=e("./../utils").networkRequest;t.exports=class ImageEvent extends o{constructor(e,t){super(e,t),this.log=n(this.constructor.name),this.type="image",this.conversation=e,this.state={seen_by:{},delivered_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}del(e=this.body.representations){return s({type:"DELETE",url:e.original.url}).then(()=>super.del())}fetchImage(e="thumbnail",t=this.body.representations){return s({type:"GET",url:t[e].url,responseType:"arraybuffer"}).then(({response:e})=>{const t=new Uint8Array(e);let r="";for(let e=0;e<t.length/8192;e++)r+=String.fromCharCode.apply(null,t.subarray(8192*e,8192*(e+1)));r+=String.fromCharCode.apply(null,t.subarray(8192*i));const n="data:image/jpeg;base64,"+btoa(r);return Promise.resolve(n)})}}},{"./../utils":28,"./nxmEvent":4,loglevel:52}],4:[function(e,t,r){const n=e("wildemitter"),i=e("../nexmoClientError").NexmoClientError,o=e("../nexmoClientError").NexmoApiError;class NXMEvent{constructor(e,t){if(this.conversation=e,t)for(const e in t)switch(e){case"type":t.type.startsWith("custom:")?this.type=t.type.replace("custom:",""):this.type=t.type;break;case"cid":this.cid=t.cid;break;case"from":this.from=t.from;break;case"timestamp":this.timestamp=t.timestamp;break;case"id":this.id=t.id;break;case"state":this.state=t.state;break;case"index":this.index=t.index;break;case"streamIndex":this.streamIndex=t.streamIndex;break;case"body":this.body=t.body,this.body.user&&this.body.user.user_id&&(this.body.user.id=this.body.user.user_id,delete this.body.user.user_id),this.body.digit&&(this.digit=this.body.digit,delete this.body.digit),this.body.digits&&(this.digit=this.body.digits,delete this.body.digits)}n.mixin(NXMEvent)}del(e=this.id){return new Promise((t,r)=>this.conversation.application.session.sendNetworkRequest({type:"DELETE",path:`conversations/${this.conversation.id}/events/${e}?from=${this.conversation.me.id}`,version:"beta2"}).then(e=>{t()}).catch(e=>{r(new o(e))}))}delivered(e=this.id){return"text"!==this.type&&"image"!==this.type&&(this.type="event"),new Promise((t,r)=>{if(this.conversation.me.id===this.from)r(new i("error:delivered:own-message"));else{if(!(this.state&&this.state.delivered_to&&this.state.delivered_to[this.conversation.me.id]))return this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.conversation.id}/events`,data:{type:`${this.type}:delivered`,from:this.conversation.me.id,body:{event_id:e}}}).then(e=>{t()}).catch(e=>{r(new o(e))});r(new i("error:already-delivered"))}})}seen(e=this.id){return"text"!==this.type&&"image"!==this.type&&(this.type="event"),new Promise((t,r)=>{if(this.conversation.me.id===this.from)r(new i("error:seen:own-message"));else{if(!(this.state&&this.state.seen_by&&this.state.seen_by[this.conversation.me.id]))return this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.conversation.id}/events`,data:{type:`${this.type}:seen`,from:this.conversation.me.id,body:{event_id:e}}}).then(e=>{t()}).catch(e=>{r(new o(e))});r(new i("error:already-seen"))}})}}t.exports=NXMEvent},{"../nexmoClientError":20,wildemitter:100}],5:[function(e,t,r){const n=e("./nxmEvent");t.exports=class TextEvent extends n{constructor(e,t){super(e,t),this.type="text",this.conversation=e,this.state={seen_by:{},delivered_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}del(){return super.del()}}},{"./nxmEvent":4}],6:[function(e,t,r){const n=e("../events/nxmEvent"),i=e("../modules/nxmCall"),o=e("../utils"),s=e("loglevel").getLogger;t.exports=class ApplicationEventsHandler{constructor(e){this.log=s(this.constructor.name),this.application=e,this._handleApplicationEventMap={"member:joined":this._processMemberJoined,"member:invited":this._processMemberInvited}}handleEvent(e){const t=this.application.conversations.get(e.cid),r=Object.assign({},e);return this._handleApplicationEventMap.hasOwnProperty(e.type)&&this._handleApplicationEventMap[e.type].call(this,t,new n(t,r))||new n(t,r)}_processMemberJoined(e,t){if(t.body.channel&&t.body.channel.knocking_id&&this.application._call_draft_list.has(t.body.channel.knocking_id)){const r=this.application._call_draft_list.get(t.body.channel.knocking_id);r._setFrom(e.me),r._setupConversationObject(e),this.application._call_draft_list.delete(t.body.channel.knocking_id),delete r.knocking_id,this.application.calls.set(e.id,r),r._handleStatusChange(t),this.application.emit("member:call",this.application.conversations.get(t.cid).members.get(t.from),r)}return t}_processMemberInvited(e,t){if(!e)return this.log.warn(`no conversation object for ${t.type}`),t;if(e.me&&e.me.user.id===t.body.invited_by||!t.body.user.media||!t.body.user.media.audio_settings||!t.body.user.media.audio_settings.enabled)return t;const r=o.getMemberNumberFromEventOrNull(t.body.channel)||o.getMemberFromNameOrNull(e,t.body.invited_by)||"unknown";if(e.display_name&&e.display_name.startsWith("CALL_")){const n=new i(this.application,e,r);this.application.calls.set(e.id,n),this.application.emit("member:call",this.application.conversations.get(t.cid).members.get(t.from),n)}else if(!t.body.invited_by){const n=new i(this.application,e,r);this.application.calls.set(e.id,n),n._handleStatusChange(t),this.application.emit("member:call",this.application.conversations.get(t.cid).members.get(t.from),n)}return t}}},{"../events/nxmEvent":4,"../modules/nxmCall":15,"../utils":28,loglevel:52}],7:[function(e,t,r){const n=e("loglevel").getLogger,i=e("../events/nxmEvent"),o=e("../events/text_event"),s=e("../events/image_event");t.exports=class ConversationEventHandler{constructor(e,t){this.log=n(this.constructor.name),this.application=e,this.conversation=t,this.constructed_event=null,this._handleEventMap={"event:delete":this._processDelete,image:this._processImage,"image:delivered":this._processDelivered,"image:seen":this._processSeen,"member:invited":this._processMember,"member:joined":this._processMember,"member:left":this._processMember,"audio:ringing:start":this._processMember,"leg:status:update":this._processLegStatus,"member:media":this._processMedia,text:this._processText,"text:delivered":this._processDelivered,"text:seen":this._processSeen,"audio:mute:on":this._processMuteForMedia,"audio:mute:off":this._processMuteForMedia,"video:mute:on":this._processMuteForMedia,"video:mute:off":this._processMuteForMedia}}handleEvent(e){return this._handleEventMap.hasOwnProperty(e.type)&&this._handleEventMap[e.type].call(this,e)||new i(this.conversation,e)}_processDelivered(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.delivered_to=t.state.delivered_to||{},t.state.delivered_to[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}_processDelete(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.body.text&&(t.body.text=""),t.body.representations&&(t.body.representations=""),t.body.timestamp={deleted:e.timestamp},t):(this.log.warn("NXMEvent not found"),null)}_processImage(e){const t=new s(this.conversation,e);return this.conversation.me.id!==t.from&&t.delivered().catch(e=>{this.log.debug(e)}),t}_processMember(e){return this.application.calls.has(this.conversation.id)&&this.application.calls.get(this.conversation.id)._handleStatusChange(e),this.conversation.members.get(e.from)._handleEvent(e),new i(this.conversation,e)}_processLegStatus(e){return this.conversation.members.get(e.from)._handleEvent(e),new i(this.conversation,e)}_processMedia(e){return this.conversation.members.get(e.from)._handleEvent(e),null}_processMuteForMedia(e){if(this.conversation.media.rtcObjects[e.body.rtc_id])e.streamIndex=this.conversation.media.rtcObjects[e.body.rtc_id].streamIndex;else if(this.conversation.remoteMembers){const t=this.conversation.remoteMembers.find(t=>t.remote_leg_id===e.body.rtc_id);t&&(e.streamIndex=t.streamIndex)}return null}_processSeen(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.seen_by=t.state.seen_by||{},t.state.seen_by[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}_processText(e){const t=new o(this.conversation,e);return this.conversation.me.id!==t.from&&t.delivered().catch(e=>{this.log.debug(e)}),t}}},{"../events/image_event":3,"../events/nxmEvent":4,"../events/text_event":5,loglevel:52}],8:[function(e,t,r){const n=e("loglevel").getLogger;t.exports=class RtcEventHandler{constructor(e){this.log=n(this.constructor.name),this.application=e}_handleRtcEvent(e){const t={"rtc:transfer":()=>{const t=this.application.conversations.get(e.body.transferred_from),r=this.application.conversations.get(e.cid),n=this.application.calls.get(e.body.transferred_from);n?(n.conversation.members.get(e.body.was_member).transferred_to=r,n._setupConversationObject(r),n.transferred=!0,this.application.calls.set(e.cid,n),this.application.calls.delete(e.body.transferred_from),t&&(r.members.get(e.from).transferred_from=t,r.media._attachEndingEventHandlers(),t.remoteMembers.map(n=>{n.remote_member_id===e.from&&(r.remoteMembers.push(n),t.remoteMembers.splice(t.remoteMembers.indexOf(n),1))}))):this.log.warn("NXMCall transfer for unknown nxmCall")},"rtc:answer":()=>{this.application.calls.has(e.cid)&&(this.application.calls.get(e.cid).id=e.body.rtc_id)}};if(t.hasOwnProperty(e.type))return t[e.type].call(this)}}},{loglevel:52}],9:[function(e,t,r){const n=e("loglevel").getLogger;t.exports=class SipEventHandler{constructor(e){this.log=n(this.constructor.name),this.application=e}_handleSipCallEvent(e){if(!this.application.calls.has(e.cid))return void this.log.warn("There is no call object for this Conversation id.");const t=this.application.calls.get(e.cid),r={"sip:hangup":()=>{t._handleStatusChange(e)},"sip:ringing":()=>{t._handleStatusChange(e)}};return r.hasOwnProperty(e.type)?r[e.type].call(this):void 0}}},{loglevel:52}],10:[function(e,t,r){(function(t){"use strict";let r=t.NexmoClient||{};r=e("./sdk"),t.NexmoClient=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./sdk":26}],11:[function(e,t,r){const n=e("wildemitter"),i=e("./events/nxmEvent"),o=e("./utils"),s=e("./nexmoClientError").NexmoApiError;class Member{constructor(e,t){this.conversation=e,this.callStatus=null,this._normalise(t),n.mixin(Member)}_normalise(e){if(e){this.user=this.user||{},this.channel=e.channel||{type:"app"};for(let t in e)switch(t){case"member_id":this.id=e.member_id;break;case"timestamp":this.timestamp=e.timestamp;break;case"state":this.state=e.state;break;case"from":this.id=e.from;break;case"user_id":this.user.id=e.user_id;break;case"name":this.user.name=e.name;break;case"user":this.user={name:e.user.name,id:e.user.user_id||e.user.id},this.display_name=this.display_name||e.user.display_name;break;case"invited_by":this.invited_by=e.invited_by;break;case"display_name":this.display_name=this.display_name||e.display_name;break;case"conversation":break;default:e.type||(this[t]=e[t])}this.conversation.application.me&&e.user_id===this.conversation.application.me.id&&(this.user.name=this.conversation.application.me.name),delete this.user_id,delete this.name,delete this.user.user_id}}playStream(e){return new Promise((t,r)=>this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:{type:"audio:play",to:this.id,body:e}}).then(e=>{t(new i(this.conversation,e))}).catch(e=>{r(new s(e))}))}sayText(e){return new Promise((t,r)=>this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:{type:"audio:say",cid:this.id,from:this.conversation.me.id,to:this.id,body:{text:e.text,voice_name:e.voice_name||"Amy",level:e.level||1,queue:e.queue||!0,loop:e.loop||1,ssml:e.ssml||!1}}}).then(e=>{t(new i(this.conversation,e))}).catch(e=>{r(new s(e))}))}kick(e){return new Promise((t,r)=>{let n=`conversations/${this.conversation.id}/members/${this.id}`;if(e){let t=new URLSearchParams;Object.keys(e).forEach(r=>{t.append(r,e[r])}),n+=`?${t.toString()}`}return this.conversation.application.session.sendNetworkRequest({type:"DELETE",path:n}).then(e=>{t(e)}).catch(e=>{r(new s(e))})})}mute(e){return this.conversation.media.mute(e)}earmuff(e){return this.conversation.media.earmuff(e)}_handleEvent(e){switch(e.type){case"member:invited":this._normalise(e.body),this.state="INVITED",this.timestamp.invited=e.body.timestamp.invited,!e.body.invited_by&&e.body.user.media&&e.body.user.media.audio_settings&&e.body.user.media.audio_settings.enabled&&this._setCallStatusAndEmit("started");break;case"member:joined":this._normalise(e.body),this.state="JOINED",this.timestamp.joined=e.body.timestamp.joined,e.body.channel&&e.body.channel.knocking_id&&this._setCallStatusAndEmit("started");break;case"member:left":this._normalise(e.body),this.state="LEFT",this.timestamp.left=e.body.timestamp.left,e.body.reason&&e.body.reason.text&&this._setCallStatusAndEmit(e.body.reason.text);break;case"member:media":this.media=e.body.media;break;case"leg:status:update":this.channel.legs=o.updateMemberLegs(this.channel.legs,e),this._setCallStatusAndEmit(e.body.status);break;case"audio:ringing:start":this.callStatus&&"started"!==this.callStatus||this._setCallStatusAndEmit("ringing")}}_setCallStatusAndEmit(e){this.callStatus!==String(e)&&(this.callStatus=e,this.conversation.emit("member:call:status",this))}}t.exports=Member},{"./events/nxmEvent":4,"./nexmoClientError":20,"./utils":28,wildemitter:100}],12:[function(e,t,r){const n=e("../nexmoClientError").NexmoClientError,i="screenshare-extension-installed";t.exports=class ChromeHelper{constructor(e){this.screenShareExtensionId=e}checkScreenShareInstalled(){return new Promise((e,t)=>{chrome.runtime.sendMessage(this.screenShareExtensionId,i,r=>{r&&"success"===r.type&&"0.1.0"===r.version?e():t(new n("error:media:extension-not-installed"))})})}getScreenShare(e){return new Promise((t,r)=>{chrome.runtime.sendMessage(this.screenShareExtensionId,{sources:e},e=>{e&&"error"!==e.type&&"success"===e.type?t(e.streamId):r(new n("error:media:extension"))})})}}},{"../nexmoClientError":20}],13:[function(e,t,r){const n=e("loglevel").getLogger,i=e("../nexmoClientError").NexmoClientError;t.exports=class ErrorsEmitter{constructor(e){if(this.log=n(this.constructor.name),!e)throw new i("no emitter object passed for the Error Emitter");this.emitter=e,this.LISTENER_GROUP="NXM-errors"}emitResponseIfError(e){if(this._isTypeError(e.type))return this.emitter.emit(e.type,this.LISTENER_GROUP,e)}cleanup(){return this.emitter.releaseGroup(this.LISTENER_GROUP)}_isTypeError(e){return-1!==e.indexOf("error")}}},{"../nexmoClientError":20,loglevel:52}],14:[function(e,t,r){const n=e("./rtc_helper"),i=e("./rtcstats/trace-ws"),o=e("./rtcstats/rtcstats"),s=e("loglevel").getLogger,a=e("../utils"),c=e("../events/nxmEvent"),u=e("../nexmoClientError").NexmoClientError,d=e("../nexmoClientError").NexmoApiError;t.exports=class Media{constructor(e){this.log=s(this.constructor.name),e?(this.rtcHelper=new n,this.application=e.application,this.application.activeStreams=this.application.activeStreams||[],this._eventsQueue=[],this.parentConversation=e,this.parentConversation.remoteMembers=[],this.rtcObjects={},this.streamIndex=0,this.rtcstats_conf={},this.rtcStats=null,this.application.session.config&&this.application.session.config.rtcstats&&(this.rtcstats_conf={emit_events:this.application.session.config.rtcstats.emit_events,ws_url:this.application.session.config.rtcstats.ws_url}),this.application.session.config&&this.application.session.config.screenShareExtensionId&&""!==this.application.session.config.screenShareExtensionId&&this.rtcHelper._setScreenShareExtensionId(this.application.session.config.screenShareExtensionId),this.rtcstats_conf.emit_events&&this._initStatsReporting()):this.log.warn("No conversation object in Media")}_attachEndingEventHandlers(){this.log.debug("attaching leave listeners in media for "+this.parentConversation.id),this.parentConversation.on("rtc:terminate",e=>{this._handleParticipantRtcTerminate(e)}),this.parentConversation.on("rtc:hangup",e=>{this.parentConversation.members.get(e.from).user.id===this.application.me.id&&this.application.activeStreams.length&&this._cleanMediaProperties()}),this.parentConversation.on("member:left",e=>{this._handleMemberLeft(e)})}_enableCallStats(e){this.application.session.callstats.addNewFabric(e,this.parentConversation.me.id,"audio",this.parentConversation.id)}_enableStatsReporting(e){this.application.session.config.rtcstats.ws_url=e,this.rtcstats_conf.ws_url=e,this._initStatsReporting()}_enableStatsEvents(){this.application.session.config.rtcstats.emit_events=!0,this.rtcstats_conf.emit_events=!0,this._initStatsEvents()}_initStatsReporting(){this.rtcHelper.isNode()||this.rtcStats||!this.application.session.config.rtcstats.ws_url||(this.rtcStats_wsConnection=new i,this.rtcStats=new o(this.rtcStats_wsConnection.trace,!1,1e3,[""]),this.rtcStats_wsConnection.init({rtcstatsUri:this.application.session.config.rtcstats.ws_url}))}_initStatsEvents(){if(!this.rtcHelper.isNode()&&!this.rtcStats){const e=(e,t,r,n)=>{"mos"===e?t&&this.application.emit("rtcstats:report",t,r,this.parentConversation):"mos_report"===e&&this.application.emit("rtcstats:report",t,null,this.parentConversation,n)};this.rtcStats=new o(e,!0,1e3,[""])}}_disableStatsReporting(){this.application.session.config.rtcstats.ws_url="",this.rtcstats_conf.ws_url="",this.rtcStats_wsConnection.disable(),delete this.rtcStats}_disableStatsEvents(){this.application.session.config.rtcstats.emit_events=!1,this.rtcstats_conf.emit_events=!1,this.rtcStats.disable(),delete this.rtcStats}_handleAudio(e={}){return new Promise((t,r)=>{const n=e=>{this.log.error(e),r(new u(e))},i=this.streamIndex;this.streamIndex++,this.rtcHelper.getUserAudio(e.audioConstraints).then(e=>{const o=a.allocateUUID(),s={iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"};this.application.session.config&&this.application.session.config.iceServers&&(s.iceServers=this.application.session.config.iceServers);const c=this.rtcHelper.createRTCPeerConnection(s,{optional:[{DtlsSrtpKeyAgreement:"true"}]},o);c.trace("conversation_id",this.parentConversation.id),c.trace("member_id",this.parentConversation.me.id),this.application.session.config.callstats&&this.application.session.config.callstats.enabled&&this._enableCallStats(c),this.pc=c,c.ontrack=(e=>{this.application.activeStreams.push(e.streams[0]),this.parentConversation.me.emit("media:stream:on",{pc:this.pc,stream:e.streams[0],type:"audio",streamIndex:i}),t(e.streams[0])}),c.addStream(e),c.onnegotiationneeded=(()=>{c.createOffer().then(e=>c.setLocalDescription(e)).catch(n)}),c.oniceconnectionstatechange=(e=>{switch(c.iceConnectionState){case"disconnected":this.log.warn("One or more transports is disconnected",c.iceConnectionState);break;case"failed":n(e),this.log.warn("One or more transports has terminated unexpectedly or in an error",e);break;default:this.log.debug("The ice connection status changed",c.iceConnectionState)}});let u=null,p=!1;c.onicegatheringstatechange=(()=>{const t=()=>{this.pc&&this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/rtc`,data:{from:this.parentConversation.me.id,body:{offer:this.pc.localDescription}}}).then(t=>{const r=t.rtc_id;c.trace("rtc_id",r),this.rtcObjects[r]={rtc_id:r,pc:c,stream:e,type:"audio",streamIndex:i}}).catch(e=>{r(new d(e))})};switch(c.iceGatheringState){case"new":this.log.debug("ice gathering new");break;case"complete":window.clearTimeout(u),u=null,p||t(),this.log.debug("ice gathering complete");break;case"gathering":u=setTimeout(()=>{t(),p=!0},2e3),this.log.debug("ice gathering gathering")}})}).then(()=>{this.parentConversation.once("rtc:answer",e=>{this.pc?this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.body.answer}),()=>{this.log.debug("remote description is set")},n):this.log.warn("RTC: received an answer too late")}),this._attachEndingEventHandlers()}).catch(e=>{r(new u(e))})})}_handleVideo(e){return new Promise((t,r)=>{if(e.video){let n,i,o="none",s="video";switch(e.video===Object(e.video)?(o=e.video.direction,s=e.video.name||"video",n=e.video.constraints):o=e.video,e.audio&&(i=e.audio.constraints),o){case"both":case"send_only":case!0:return this.rtcHelper.getUserVideo(n,i).then(r=>{this._handleVideoSend(r,"send_only"===o,"video",s,e),t(r)});case"receive_only":this.log.debug("video - receive_only not implemented yet"),r(new d("Not implemented yet"));break;case"none":t();break;default:if(!1===o){let e=this._findRtcObjectByType("video");e?t(this._disableLeg(e.rtc_id)):t()}else t()}}t()}).then(t=>new Promise((r,n)=>{if(e.screenshare){let t,n=!1,i={sources:["screen","window","tab"]};switch(e.screenshare===Object(e.screenshare)?(n=e.screenshare.direction,t=e.screenshare.name||"screenshare",i.sources=e.screenshare.sources||i.sources,i.sourceId=e.screenshare.sourceId||""):n=e.screenshare,n){case"send_only":case!0:return this.rtcHelper.getUserScreen(i).then(n=>{this._handleVideoSend(n,!0,"screenshare",t,e),r(n)});case"none":r();break;default:if(!1===n){let e=this._findRtcObjectByType("screenshare");e?r(this._disableLeg(e.rtc_id)):r()}else r()}}else r(t)}))}_emitEventsByRtcId(e){this._eventsQueue.filter(t=>t.rtc_id===e).forEach(e=>{e.func(),e.ran=!0}),this._eventsQueue=this._eventsQueue.filter(e=>!1===e.ran)}_runWhenLegInitialized(e,t){this.rtcObjects[e]?t():this._eventsQueue.push({rtc_id:e,func:t,ran:!1})}_handleVideoSend(e,t,r,n,i){let o=null;const s=a.allocateUUID(),c=this.rtcHelper.createRTCPeerConnection({iceServers:this.application.session.config.iceServers,iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"},{optional:[{DtlsSrtpKeyAgreement:"true"}]},s);c.trace("conversation_id",this.parentConversation.id),c.trace("member_id",this.parentConversation.me.id),this.application.session.config.callstats&&this.application.session.config.callstats.enabled&&this._enableCallStats(c),this.listeningToRtcEvent||this.parentConversation.on("rtc:answer",e=>{this._runWhenLegInitialized(e.body.rtc_id,()=>{this.rtcObjects[e.body.rtc_id].pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:this.rtcHelper.editSDPOrder(c.localDescription.sdp,e.body.answer)})).then(()=>{this.log.debug("remote description is set")}).catch(e=>{this.log.warn("set remote description failed with error",e)})})}),t||this.listeningToRtcEvent||this.parentConversation.on("rtc:offer",e=>{this._runWhenLegInitialized(e.body.leg_id,()=>{this._handleNewOffer(i,e)})}),this.listeningToRtcEvent=!0,c.ontrack=(e=>{this.log.debug("ontrack"),this.application.activeStreams.push(e.streams[0])}),c.addStream(e);let u=this.streamIndex;this.streamIndex++;const p=new Promise((e,t)=>{c.createOffer().then(e=>c.setLocalDescription(e)).catch(e=>new d(e))});c.oniceconnectionstatechange=(e=>{switch(c.iceConnectionState){case"disconnected":this.log.warn("One or more transports is disconnected",c.iceConnectionState);break;case"failed":this._onConnectionFail(this.parentConversation.me,{rtc_id:o,streamIndex:u,type:r,member_id:this.parentConversation.me.id,connection_event:e}),this.log.warn("One or more transports has terminated unexpectedly or in an error",e);break;default:this.log.debug("The ice connection status changed",c.iceConnectionState)}});const l=()=>{if(!c)return;const s=t?"send_only":"both",a={type:"rtc:new",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{offer:{sdp:c.localDescription.sdp},video:{direction:s,name:n}}};this.application.session.sendRequest(a,t=>{if("rtc:new:success"!==t.type)return new d(t);{const i=t.body.rtc_id;o=i,c.trace("rtc_id",i),this.rtcObjects[i]={rtc_id:i,pc:c,stream:e,type:r,streamIndex:u},this._emitEventsByRtcId(i),c.trace("rtc_id",i),"screenshare"===r&&(e.getVideoTracks()[0].onended=(()=>{this._disableLeg(i).then(()=>{this.parentConversation.me.emit("media:stream:off",u)}).catch(()=>{this.parentConversation.me.emit("media:stream:off",u)})})),this.parentConversation.me.emit("media:stream:on",{type:r,name:n,streamIndex:u,stream:e})}}),i&&i.label&&(a.label=i.label)};let h=null,f=!1;return c.onicegatheringstatechange=(()=>{switch(c.iceGatheringState){case"new":this.log.debug("ice gathering new");break;case"complete":window.clearTimeout(h),h=null,f||l(),this.log.debug("ice gathering complete");break;case"gathering":h=setTimeout(()=>{l(),f=!0},2e3),this.log.debug("ice gathering gathering")}}),this._attachEndingEventHandlers(),this.log.debug("sending local stream"),p}_handleNewOffer(e,t){const r={remote_member_id:t.body.member_id,remote_leg_id:t.body.member_leg_id,local_leg_id:t.body.leg_id,name:t.body.name,streamIndex:this.streamIndex};let n=this.streamIndex;this.streamIndex++;const i=!(!t.body.media_settings||!t.body.media_settings.video)&&t.body.media_settings.video.muted,o=!(!t.body.media_settings||!t.body.media_settings.audio)&&t.body.media_settings.audio.muted;for(let e of this.parentConversation.members.values()){const n=e.id;n===t.body.member_id&&(r.remote_member=this.parentConversation.members.get(n))}this.parentConversation.remoteMembers.push(r),this.log.debug("handle rtc:offer for member "+r.remote_member_id);const s=a.allocateUUID();r.pc=this.rtcHelper.createRTCPeerConnection({iceServers:this.application.session.config.iceServers,iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"},{optional:[{DtlsSrtpKeyAgreement:"true"}]},s),this.application.session.config.callstats&&this.application.session.config.callstats.enabled&&this._enableCallStats(pc),r.pc.trace("conversation_id",this.parentConversation.id),r.pc.trace("member_id",this.parentConversation.me.id),r.pc.trace("rtc_id",r.local_leg_id),r.pc.trace("other_member_id",r.remote_member_id),r.pc.ontrack=(e=>{r.stream!==e.streams[0]&&(r.stream=e.streams[0],r.remote_member.emit("media:stream:on",{streamIndex:r.streamIndex,rtc_id:r.local_leg_id,remote_member_id:r.remote_member_id,name:r.name,stream:r.stream,video_mute:i,audio_mute:o}))}),r.pc.oniceconnectionstatechange=(i=>{switch(r.pc.iceConnectionState){case"disconnected":this.log.warn("One or more transports is disconnected",r.pc.iceConnectionState);break;case"failed":this._onConnectionFail(r.remote_member,{rtc_id:r.local_leg_id,streamIndex:n,type:e.video?"video":"screenshare",member_id:r.remote_member_id,connection_event:i}),this.log.warn("transports has terminated or failed for member "+t.body.member_id,t);break;default:this.log.debug("The ice connection status changed for member "+t.body.member_id,r.pc.iceConnectionState)}});const c=()=>{if(!r.pc)return;const t={from:this.parentConversation.me.id,body:{other_member_id:r.remote_member_id,answer:r.pc.localDescription.sdp,leg_id:r.remote_leg_id}};e&&e.label&&(t.label=e.label),this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/rtc/${r.local_leg_id}/answer`,data:t}).then(e=>{this.log.debug("successfully set answer for member "+r.remote_member_id)}).catch(e=>{this.log.error("rtc:answer:failed: failed to set answer for member "+r.remote_member_id)})};let u=null,d=!1;r.pc.onicegatheringstatechange=(()=>{switch(r.pc.iceGatheringState){case"new":this.log.debug("ice gathering new for member "+t.body.member_id);break;case"complete":window.clearTimeout(u),u=null,d||c(),this.log.debug("ice gathering complete for member "+t.body.member_id);break;case"gathering":u=setTimeout(()=>{c(),d=!0},2e3),this.log.debug("ice gathering gathering for member "+t.body.member_id)}}),this._runWhenLegInitialized(r.local_leg_id,()=>{r.pc.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:t.body.sdp})).then(()=>r.pc.createAnswer()).then(e=>r.pc.setLocalDescription(e))})}_onConnectionFail(e,t){return this._disableLeg(t.rtc_id).catch(e=>new d(e)).finally(()=>e.emit("media:connection:fail",t))}_handleMemberLeft(e){const t=e.id;this.parentConversation.remoteMembers.filter(e=>e.remote_member_id===t).forEach(e=>{this._handleParticipantRtcTerminate({body:{rtc_id:e.remote_leg_id}})})}_handleParticipantRtcTerminate(e){const t=this.parentConversation.remoteMembers.find(t=>t.remote_leg_id===e.body.rtc_id);t?(this.parentConversation.remoteMembers=this.parentConversation.remoteMembers.filter(t=>t.remote_leg_id!==e.body.rtc_id),this._deleteMemberMedia(t),t.remote_member.emit("media:stream:off",{remote_member_id:t.remote_member_id,streamIndex:t.streamIndex})):this.log.error("rtc:terminate was sent with invalid member id")}_deleteMemberMedia(e){this._closeStream(e.stream),e.pc.close()}_findRtcObjectByType(e){return Object.values(this.rtcObjects).find(t=>t.type===e)}update(e){return new Promise((t,r)=>{this._validateUpdateParams(e).then(()=>{if(e.video){const t=this._findRtcObjectByType("video");if(t&&e.video.direction||!t&&!e.video.direction)return r(new u("error:media:update:invalid"))}else if(e.screenshare){const t=this._findRtcObjectByType("screenshare");if(t&&e.screenshare.direction||!t&&!e.screenshare.direction)return r(new u("error:media:update:invalid"))}return this._handleVideo(e).then(t).catch(r)}).catch(e=>r(e))})}_validateUpdateParams(e){return new Promise((t,r)=>e&&(e.video||e.screenshare)?e.video&&e.screenshare?r(new u("error:media:update:streams")):void t():r(new u("error:media:update:unsupported")))}_closeStream(e){e.getTracks().forEach(e=>{e.stop()})}_cleanConversationProperties(){return Promise.resolve().then(()=>{this.pc&&this.pc.close(),this.parentConversation.remoteMembers&&this.parentConversation.remoteMembers.forEach(e=>{e.remote_member.emit("media:stream:off",{remote_member_id:e.remote_member_id,streamIndex:e.streamIndex}),this._deleteMemberMedia(e)}),delete this.pc,this.rtcStats=null,this.application.activeStreams=[],this.parentConversation.remoteMembers=[],this.listeningToRtcEvent=!1})}_cleanMediaProperties(){if(this.pc&&this.pc.close(),this.rtcObjects)for(const e in this.rtcObjects)this._closeStream(this.rtcObjects[e].stream);delete this.pc,this.rtcStats=null,this.application.activeStreams=[],this.rtcObjects={},this.parentConversation.remoteMembers=[],this.listeningToRtcEvent=!1}_disableLeg(e){const t=new Promise((t,r)=>{this.application.session.sendNetworkRequest({type:"DELETE",path:`conversations/${this.parentConversation.id}/rtc/${e}?from=${this.parentConversation.me.id}&originating_session=${this.application.session.session_id}`,version:"beta2"}).then(e=>{t("rtc:terminate:success")}).catch(e=>{r(new d(e))})}),r=Promise.resolve().then(()=>{this.rtcObjects[e].pc&&this.rtcObjects[e].pc.close(),this.rtcObjects[e].stream&&this._closeStream(this.rtcObjects[e].stream)});return Promise.all([t,r]).then(()=>(this.parentConversation.me.emit("media:stream:off",this.rtcObjects[e].streamIndex),delete this.rtcObjects[e],Promise.resolve("rtc:terminate:success"))).catch(e=>Promise.reject(e))}_enableMediaTracks(e,t){e.forEach(e=>{e.enabled=t})}_setMediaTracksAndMute(e,t,r,n){return this._enableMediaTracks(t,!r),new Promise((i,o)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:n,to:this.parentConversation.me.id,from:this.parentConversation.me.id,body:{rtc_id:e}}}).then(e=>{i(e)}).catch(e=>{this._enableMediaTracks(t,r),o(new d(e))}))}updateSource(e,t="video"){if(!RTCRtpSender.prototype.replaceTrack)return Promise.reject(new d("Not implemented yet"));let r=this._findRtcObjectByType(t);return r&&r.pc?this.rtcHelper.getUserVideo(e.video,e.audio).then(e=>(e.getTracks().forEach(e=>{const t=r.pc.getSenders().find(t=>t.track.kind===e.kind);t&&(e.enabled=t.track.enabled,t.replaceTrack(e))}),this._closeStream(r.stream),r.stream=e,e)):Promise.reject(new d("error:media:stream:not-found"))}updateAudioConstraints(e={}){let t=this._findRtcObjectByType("audio");return t&&t.pc?this.rtcHelper.getUserAudio(e).then(e=>(e.getTracks().forEach(e=>{const r=t.pc.getSenders().find(t=>t.track.kind===e.kind);r&&(e.enabled=r.track.enabled,r.replaceTrack(e))}),this._closeStream(t.stream),t.stream=e,e)).catch(e=>e):Promise.reject(new d("error:media:stream:not-found"))}mute(e=!1,t=!0,r=!1,n=null){const i=e?"on":"off",o="audio:mute:"+i,s="video:mute:"+i;let a=[],c={};if(null!==n){if(c[0]=Object.values(this.rtcObjects).find(e=>e.streamIndex===n),!c[0])throw new u("error:media:stream:not-found")}else c=this.rtcObjects;return Object.values(c).forEach(n=>{if(t){const t=n.stream.getAudioTracks(),r=this._setMediaTracksAndMute(n.rtc_id,t,e,o);a.push(r)}if(r){const t=n.stream.getVideoTracks(),r=this._setMediaTracksAndMute(n.rtc_id,t,e,s);a.push(r)}}),Promise.all(a)}earmuff(e){return new Promise((t,r)=>{if(null!==this.me){let n="audio:earmuff:off";return e&&(n="audio:earmuff:on"),this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:n,to:this.parentConversation.me.id}}).then(({response:e})=>{t(e)}).catch(e=>{r(new d(e))})}r(new u("error:self"))})}enable(e){return new Promise((t,r)=>{if(null===this.parentConversation.me)r(new u("error:self"));else{if(e&&this.parentConversation.is_video_conversation)return this._handleVideo(e).then(r=>{let n=[];["video","screenshare"].forEach(t=>{if(!e[t]){let e=this._findRtcObjectByType(t);e&&n.push(this._disableLeg(e.rtc_id))}}),Promise.all(n).then(()=>{t(r)})}).catch(e=>{r(e)});this.rtcstats_conf.emit_events&&this._initStatsEvents(),this._handleAudio(e).then(r=>{let n=!(!e||!e.autoPlayAudio&&void 0!==e.autoPlayAudio);e&&!n||this.rtcHelper._playAudioStream(r),t(r)}).catch(e=>{r(e)})}})}disable(){let e=[];e.push(this._cleanConversationProperties());for(const t in this.rtcObjects)e.push(this._disableLeg(t));return Promise.all(e)}sayText(e){return new Promise((t,r)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:say",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{text:e.text,voice_name:e.voice_name||"Amy",level:e.level||1,queue:e.queue||!0,loop:e.loop||1,ssml:e.ssml||!1}}}).then(e=>{t(new c(this.conversation,e))}).catch(e=>{r(new d(e))}))}sendDTMF(e){return new Promise((t,r)=>{if(a.validateDTMF(e))return this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:dtmf",from:this.parentConversation.me.id,body:{digit:e}}}).then(r=>{const n={body:{digit:e,dtmf_id:""},cid:this.parentConversation.id,from:this.parentConversation.me.id,id:r.id,timestamp:r.timestamp,type:"audio:dtmf"},i=new c(this.parentConversation,n);this.parentConversation.events.set(n.id,i),t(i)}).catch(e=>{r(new d(e))});r(new u("error:audio:dtmf:invalid-digit"))})}playStream(e){return new Promise((t,r)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:play",body:e}}).then(e=>{t(new c(this.parentConversation,e))}).catch(e=>{r(new d(e))}))}startRinging(){return new Promise((e,t)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:ringing:start",from:this.parentConversation.me.id,body:{}}}).then(t=>{e(new c(this.parentConversation,t))}).catch(e=>{t(new d(e))}))}stopRinging(){return new Promise((e,t)=>this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:ringing:stop",from:this.parentConversation.me.id,body:{}}}).then(t=>{e(new c(this.parentConversation,t))}).catch(e=>{t(new d(e))}))}}},{"../events/nxmEvent":4,"../nexmoClientError":20,"../utils":28,"./rtc_helper":16,"./rtcstats/rtcstats":18,"./rtcstats/trace-ws":19,loglevel:52}],15:[function(e,t,r){const n=e("wildemitter"),i=e("../nexmoClientError").NexmoClientError,o=e("../nexmoClientError").NexmoApiError,s=e("loglevel").getLogger;class NXMCall{constructor(e,t,r){this.application=e,this.log=s(this.constructor.name),this.from=r,this.conversation=null,this.CALL_STATUS={STARTED:"started",RINGING:"ringing",ANSWERED:"answered",COMPLETED:"completed",BUSY:"busy",TIMEOUT:"timeout",UNANSWERED:"unanswered",REJECTED:"rejected",FAILED:"failed"},this.CALL_DIRECTION={INBOUND:"inbound",OUTBOUND:"outbound"},Object.freeze(this.CALL_DIRECTION),this.STATUS_PERMITTED_FLOW=new Map([["STARTED",new Set([this.CALL_STATUS.RINGING,this.CALL_STATUS.ANSWERED,this.CALL_STATUS.FAILED,this.CALL_STATUS.TIMEOUT,this.CALL_STATUS.UNANSWERED,this.CALL_STATUS.REJECTED,this.CALL_STATUS.BUSY])],["RINGING",new Set([this.CALL_STATUS.ANSWERED,this.CALL_STATUS.FAILED,this.CALL_STATUS.TIMEOUT,this.CALL_STATUS.UNANSWERED,this.CALL_STATUS.REJECTED,this.CALL_STATUS.BUSY])],["ANSWERED",new Set([this.CALL_STATUS.COMPLETED,this.CALL_STATUS.FAILED])]]),Object.freeze(this.STATUS_PERMITTED_FLOW),this.status=null,this.direction=this.CALL_DIRECTION.INBOUND,this._setupConversationObject(t),n.mixin(NXMCall)}_enableStatsEvents(){if(this.application.session.config&&this.application.session.config.rtcstats&&!this.application.session.config.rtcstats.emit_events)return this.conversation.media._enableStatsEvents()}_attachCallListeners(){this.conversation.releaseGroup("call_module"),this.conversation.on("member:media","call_module",(e,t)=>{this.application.calls&&this.application.calls.has(this.conversation.id)&&this.application.calls.get(this.conversation.id)._handleStatusChange(t)})}_isValidStatusTransition(e){if(!e)throw new i(`Provide the status to validate the transition from '${this.status}'`);if(!this.status)return!0;const t=this.status.toUpperCase();return!!this.STATUS_PERMITTED_FLOW.has(t)&&(this.status!==e&&this.STATUS_PERMITTED_FLOW.get(t).has(e))}hangUpIfAllLeft(){if(!this.conversation.me||"LEFT"===this.conversation.me.state||this.conversation.members.size<=1)return Promise.resolve();for(let e of this.conversation.members.values())if("LEFT"!==e.state&&this.conversation.me.user.id!==e.user.id)return Promise.resolve();return this.hangUp()}_setupConversationObject(e){e&&(this.conversation=e,e.me?(this.to=new Map(e.members),this.from&&this.to.delete(this.from.id)):this.log.debug("missing own member object"),this._attachCallListeners())}_setFrom(e){this.from=e}_handleStatusChange(e){const t=!this.conversation||this.conversation.me.id===e.from,r=this.direction===this.CALL_DIRECTION.OUTBOUND,n={"member:joined":()=>e.body.channel&&e.body.channel.knocking_id?this.conversation.media.enable().then(e=>(this._setStatusAndEmit(this.CALL_STATUS.STARTED),Promise.resolve())).catch(e=>(this._setStatusAndEmit(this.CALL_STATUS.FAILED),this.log.error(e),Promise.reject(e))):Promise.resolve(),"member:invited":()=>(null===e.body.invited_by&&e.body.user.media&&e.body.user.media.audio_settings&&this._setStatusAndEmit(this.CALL_STATUS.STARTED),Promise.resolve()),"member:left":()=>this.status===this.CALL_STATUS.ANSWERED?(this._setStatusAndEmit(this.CALL_STATUS.COMPLETED),Promise.resolve()):t&&r||!t&&!r?(this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve()):(this._setStatusAndEmit(this.CALL_STATUS.REJECTED),Promise.resolve()),"member:media":()=>(this.status!==this.CALL_STATUS.ANSWERED&&e.body.audio&&(t&&r||this._setStatusAndEmit(this.CALL_STATUS.ANSWERED),t&&e.body.channel&&(this.id=e.body.channel.id)),Promise.resolve()),"sip:ringing":()=>(this.status!==this.CALL_STATUS.RINGING&&this._setStatusAndEmit(this.CALL_STATUS.RINGING),Promise.resolve()),"sip:hangup":()=>{switch(e.body.reason.sip_code){case 486:this._setStatusAndEmit(this.CALL_STATUS.BUSY);break;case 487:this._setStatusAndEmit(this.CALL_STATUS.TIMEOUT);break;case 403:this._setStatusAndEmit(this.CALL_STATUS.FAILED)}return Promise.resolve()},"knocking:delete:success":()=>(this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve())};if(n.hasOwnProperty(e.type))return n[e.type].call(this)}_setStatusAndEmit(e){this._isValidStatusTransition(e)?(this.status=e,this.application.emit("call:status:changed",this)):this.log.warn(`status attempt switch from ${this.status} to ${e}`)}answer(e=!0){return this.conversation?this.conversation.join().then(()=>this.conversation.media.enable({autoPlayAudio:e})).catch(e=>(this._setStatusAndEmit(this.CALL_STATUS.FAILED),this.log.error(e),Promise.reject(e))):Promise.reject(new i("error:call:answer"))}createCall(e,t=!0){return e&&Array.isArray(e)&&0!==e.length?this.application.newConversationAndJoin({display_name:"CALL_"+this.application.me.name+"_"+e.join("_").replace(" ","")}).then(r=>{this.from=r.me,this.successful_invited_members=new Map;const n=e.map(e=>r.inviteWithAudio({user_name:e}).then(e=>(this.successful_invited_members.set(e.id,e),Promise.resolve(e))).catch(e=>(this.log.warn(e),Promise.resolve(e)))),i=()=>this.successful_invited_members.size>0?r.media.enable({audio:{muted:!1,earmuffed:!1},autoPlayAudio:t}).then(e=>(this.application.calls.set(r.id,this),Promise.resolve(n))):Promise.reject(n);return Promise.all(n).then(()=>(this._setupConversationObject(r),i()))}).catch(e=>(this.log.warn(e),this._setStatusAndEmit(this.CALL_STATUS.FAILED),Promise.reject(e))):Promise.reject(new i("error:application:call:params"))}createServerCall(e,t){const r={type:t};return"phone"===t?r.number=e:r.user=e,new Promise((e,t)=>{this.application.session.sendNetworkRequest({type:"POST",path:"knocking",data:{channel:{type:"app",from:{type:"app"},to:r}}}).then(t=>{e(t)}).catch(e=>{t(new o(e))})})}hangUp(e){let t=[];return this.conversation&&t.push(this.conversation.media.disable()),Promise.all(t).finally(()=>this.knocking_id?new Promise((t,r)=>{let n=`knocking/${this.knocking_id}`;if(e){let t=new URLSearchParams;Object.keys(e).forEach(r=>{t.append(r,e[r])}),n+=`?${t.toString()}`}this.application.session.sendNetworkRequest({type:"DELETE",path:n}).then(e=>{this.application._call_draft_list.get(this.knocking_id)._handleStatusChange(e),this.application._call_draft_list.delete(this.knocking_id),t(e)}).catch(n=>{this.conversation?(this.conversation.leave(e).then(t).catch(r),this.log.warn(new o(n))):(this.log.warn("Problem cancelling the call: Knocking cancel failed and Conversation.leave not available"),t())})}):this.conversation.leave(e))}reject(e){return this.conversation?this.conversation.leave(e):Promise.reject(new i("error:call:reject"))}}t.exports=NXMCall},{"../nexmoClientError":20,loglevel:52,wildemitter:100}],16:[function(e,t,r){e("webrtc-adapter");const n=e("detect-browser"),i=e("loglevel").getLogger,o=e("./chrome_helper"),s=e("../nexmoClientError").NexmoClientError;t.exports=class RtcHelper{constructor(){this.log=i(this.constructor.name)}getUserAudio(e=!0){let t={video:!1,audio:e};return navigator.mediaDevices.getUserMedia(t)}getUserVideo(e=!0,t=!0){let r={video:e,audio:t};return navigator.mediaDevices.getUserMedia(r)}getUserScreen(e){return Promise.resolve().then(()=>e&&e.sourceId?Promise.resolve():this.checkChromeExtensionIsInstalled()).then(()=>this.getShareScreenStream(e))}createRTCPeerConnection(e,t,r){t.optional.push({clientId:r});const n=new RTCPeerConnection(e,t);return n.trace=(()=>{}),n}checkChromeExtensionIsInstalled(){return"chrome"===this._getBrowserName()?(this.chromeHelper||this._initChromeHelper(),this.chromeHelper.checkScreenShareInstalled()):Promise.resolve()}getShareScreenStream(e){switch(this._getBrowserName()){case"chrome":return this.chromeGetShareScreenStream(e);case"firefox":return this.fireFoxGetShareScreenStream();default:return Promise.reject(new s("error:media:unsupported-browser"))}}fireFoxGetShareScreenStream(){return navigator.mediaDevices.getUserMedia({video:{mozMediaSource:"screen",mediaSource:"screen"},audio:!1})}chromeGetShareScreenStream(e){if(this.chromeHelper||this._initChromeHelper(),e&&e.sourceId)return this._getScreenShareStream(e.sourceId);const t=e?e.sources:void 0;return this.chromeHelper.getScreenShare(t).then(e=>this._getScreenShareStream(e))}_getScreenShareStream(e){const t={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:15,chromeMediaSourceId:e},optional:[]}};return navigator.mediaDevices.getUserMedia(t)}_playAudioStream(e){const t=new Audio;return t.srcObject=e,t.autoplay=!0,t}_getWindowLocationProtocol(){return window.location.protocol}_getBrowserName(){return n.detect().name}_setScreenShareExtensionId(e){return"string"!=typeof e?Promise.reject(new s("not a valid extension id string")):(this.screenShareExtensionId=e,Promise.resolve())}_initChromeHelper(){return this.screenShareExtensionId?(this.chromeHelper=new o(this.screenShareExtensionId),Promise.resolve(this.chromeHelper)):Promise.reject(new s("screenShareExtensionId not set, set it with _setScreenShareExtensionId(screenShareExtensionId)"))}isNode(){return"node"===this._getBrowserName()}editSDPOrder(e,t){const r=e.toLowerCase().substring(e.toLowerCase().indexOf("a=group:bundle")).split("\n")[0];if(""!==r&&(r.includes("0")&&r.includes("1")||r.includes("audio")&&r.includes("video"))){const e=t.indexOf("m=audio"),n=t.indexOf("m=video");r.replace("audio","0"),r.replace("video","1");const i=r.replace("a=group:bundle","").replace(/\s/g,"");if(Number(i[0])<Number(i[1])&&e>n)return t.substring(0,n).concat(t.substring(e,t.length),t.substring(n,e));if(Number(i[0])>Number(i[1])&&e<n)return t.substring(0,e).concat(t.substring(n,t.length),t.substring(e,n))}return t}checkValidKeys(e,t){let r=!0;return Object.keys(e).forEach(e=>{t.hasOwnProperty(e)||(r=!1)}),r}}},{"../nexmoClientError":20,"./chrome_helper":12,"detect-browser":42,loglevel:52,"webrtc-adapter":85}],17:[function(e,t,n){!function(){return function r(t,n,i){function o(a,c){if(!n[a]){if(!t[a]){let t="function"==typeof e&&e;if(!c&&t)return t(a,!0);if(s)return s(a,!0);let r=new Error("Cannot find module '"+a+"'");throw r.code="MODULE_NOT_FOUND",r}let u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return o(t[a][1][e]||e)},u,u.exports,r,t,n,i)}return n[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)o(i[a]);return o}}()({1:[function(e,t,r){},{"./rtcstats":2,"./trace-ws":3}],2:[function(e,t,r){"use strict";function deltaCompression(e,t){return t=JSON.parse(JSON.stringify(t)),Object.keys(t).forEach(r=>{if(!e[r])return;let n=t[r];Object.keys(n).forEach(i=>{n[i]===e[r][i]&&delete t[r][i],delete n.timestamp,0===Object.keys(n).length&&delete t[r]})}),t.timestamp=new Date,t}function dumpStream(e){return{id:e.id,tracks:e.getTracks().map(e=>({id:e.id,kind:e.kind,label:e.label,enabled:e.enabled,muted:e.muted,readyState:e.readyState}))}}t.exports=function(e,t,r){let n=0,i=!!window.mozRTCPeerConnection,o=!!window.RTCIceGatherer,s=!i&&window.RTCPeerConnection&&!window.navigator.webkitGetUserMedia;if(r.forEach(function(r){if(!window[r+"RTCPeerConnection"])return;if("webkit"===r&&o)return;let a=window[r+"RTCPeerConnection"],c=(r,c)=>{let u=new a(r,c),d="PC_"+n++;if(u.__rtcStatsId=d,r||(r={nullConfig:!0}),((r=JSON.parse(JSON.stringify(r)))&&r.iceServers||[]).forEach(function(e){delete e.credential}),r.browserType=i?"moz":o?"edge":"webkit",e("create",d,r),c&&e("constraints",d,c),u.addEventListener("icecandidate",t=>{e("onicecandidate",d,t.candidate)}),u.addEventListener("addstream",t=>{e("onaddstream",d,t.stream.id+" "+t.stream.getTracks().map(e=>e.kind+":"+e.id))}),u.addEventListener("track",t=>{e("ontrack",d,t.track.kind+":"+t.track.id+" "+t.streams.map(e=>"stream:"+e.id))}),u.addEventListener("removestream",t=>{e("onremovestream",d,t.stream.id+" "+t.stream.getTracks().map(e=>e.kind+":"+e.id))}),u.addEventListener("signalingstatechange",()=>{e("onsignalingstatechange",d,u.signalingState)}),u.addEventListener("iceconnectionstatechange",()=>{e("oniceconnectionstatechange",d,u.iceConnectionState)}),u.addEventListener("icegatheringstatechange",()=>{e("onicegatheringstatechange",d,u.iceGatheringState)}),u.addEventListener("negotiationneeded",()=>{e("onnegotiationneeded",d)}),u.addEventListener("datachannel",t=>{e("ondatachannel",d,[t.channel.id,t.channel.label])}),!o){let r={},n=window.setInterval(()=>{"closed"!==u.signalingState?i||s?u.getStats(null).then(t=>{let n=function map2obj(e){if(!e.entries)return e;let t={};return e.forEach((e,r)=>{t[r]=e}),t}(t),i=JSON.parse(JSON.stringify(n));e("getstats",d,deltaCompression(r,n)),r=i}):u.getStats(t=>{let n=function mangleChromeStats(e,t){let r={};return t.result().forEach(t=>{let n={id:t.id,timestamp:t.timestamp.getTime(),type:t.type};if(t.names().forEach(e=>{n[e]=t.stat(e)}),"ssrc"===t.type&&!n.mediaType&&n.googTrackId){let r=e.getRemoteStreams().concat(e.getLocalStreams());for(let e=0;e<r.length&&!n.mediaType;e++){let i=r[e].getTracks();for(let e=0;e<i.length;e++)i[e].id===n.googTrackId&&(n.mediaType=i[e].kind,t.mediaType=i[e].kind)}}r[n.id]=n}),r}(u,t),i=JSON.parse(JSON.stringify(n));e("getstats",d,deltaCompression(r,n)),r=i},e=>{}):window.clearInterval(n)},t)}return u};["createDataChannel","close"].forEach(t=>{let r=a.prototype[t];r&&(a.prototype[t]=function(){return e(t,this.__rtcStatsId,arguments),r.apply(this,arguments)})}),["addStream","removeStream"].forEach(t=>{let r=a.prototype[t];r&&(a.prototype[t]=function(){let n=arguments[0],i=n.getTracks().map(e=>e.kind+":"+e.id);return e(t,this.__rtcStatsId,n.id+" "+i),r.apply(this,arguments)})}),["addTrack"].forEach(t=>{let r=a.prototype[t];r&&(a.prototype[t]=function(){let n=arguments[0],i=[].slice.call(arguments,1);return e(t,this.__rtcStatsId,n.kind+":"+n.id+" "+(i.map(e=>"stream:"+e.id).join(";")||"-")),r.apply(this,arguments)})}),["removeTrack"].forEach(t=>{let r=a.prototype[t];r&&(a.prototype[t]=function(){let n=arguments[0].track;return e(t,this.__rtcStatsId,n?n.kind+":"+n.id:"null"),r.apply(this,arguments)})}),["createOffer","createAnswer"].forEach(t=>{let r=a.prototype[t];r&&(a.prototype[t]=function(){let n,i=this.__rtcStatsId,o=arguments;return 1===arguments.length&&"object"==typeof arguments[0]?n=arguments[0]:3===arguments.length&&"object"==typeof arguments[2]&&(n=arguments[2]),e(t,this.__rtcStatsId,n),r.apply(this,n?[n]:void 0).then(r=>{if(e(t+"OnSuccess",i,r),!(o.length>0&&"function"==typeof o[0]))return r;o[0].apply(null,[r])},r=>{if(e(t+"OnFailure",i,r.toString()),!(o.length>1&&"function"==typeof o[1]))throw r;o[1].apply(null,[r])})})}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(t=>{let r=a.prototype[t];r&&(a.prototype[t]=function(){let n=this.__rtcStatsId,i=arguments;return e(t,this.__rtcStatsId,i[0]),r.apply(this,[i[0]]).then(()=>{e(t+"OnSuccess",n),i.length>=2&&"function"==typeof i[1]&&i[1].apply(null,[])},r=>{if(e(t+"OnFailure",n,r.toString()),!(i.length>=3&&"function"==typeof i[2]))throw r;i[2].apply(null,[r])})})}),a.generateCertificate&&Object.defineProperty(c,"generateCertificate",{get:()=>arguments.length?a.generateCertificate.apply(null,arguments):a.generateCertificate}),window[r+"RTCPeerConnection"]=c,window[r+"RTCPeerConnection"].prototype=a.prototype}),r.forEach(t=>{let r=t+(t.length?"GetUserMedia":"getUserMedia");if(!navigator[r])return;let n=navigator[r].bind(navigator);navigator[r]=(()=>{e("getUserMedia",null,arguments[0]);let t=arguments[1],r=arguments[2];n(arguments[0],r=>{e("getUserMediaOnSuccess",null,dumpStream(r)),t&&t(r)},t=>{e("getUserMediaOnFailure",null,t.name),r&&r(t)})}).bind(navigator)}),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){let t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),r=()=>(e("navigator.mediaDevices.getUserMedia",null,arguments[0]),t.apply(navigator.mediaDevices,arguments).then(t=>(e("navigator.mediaDevices.getUserMediaOnSuccess",null,dumpStream(t)),t),t=>(e("navigator.mediaDevices.getUserMediaOnFailure",null,t.name),Promise.reject(t))));navigator.mediaDevices.getUserMedia=r.bind(navigator.mediaDevices)}}},{}],3:[function(e,t,r){t.exports=(e=>{let t=[],r=new WebSocket(e+window.location.pathname,"1.0");return r.onerror=(e=>{}),r.onopen=(()=>{for(;t.length;)r.send(JSON.stringify(t.shift()))}),function trace(){let e=Array.prototype.slice.call(arguments);e.push((new Date).getTime()),1===r.readyState?r.send(JSON.stringify(e)):"getstats"!==e[0]&&t.push(e)}})},{}]},{},[1])},{}],18:[function(e,t,r){const n=e("./rtcstats-reporter");class RTCStats{constructor(e,t,r,i){this.mos_report={min:5,max:0},this._reportsCount=0,this._mosSum=0;let o=this;if(t){let t=window.RTCPeerConnection,n=function(n,i){let s=new t(n,i);return o.stats_interval||(o.stats_interval=window.setInterval(()=>{if("closed"!==s.signalingState)s.getStats(null).then(t=>{let r=o.getMos(t);e("mos",r,t)});else{window.clearInterval(o.stats_interval);let t=o.getMOSReport();e("mos_report",t.last,null,t)}},r)),s};window.RTCPeerConnection=n,window.RTCPeerConnection.prototype=t.prototype}else n(e,t,r,i)}disable(){if(!this.stats_interval)throw new Error("rtc stats not enabled");window.clearInterval(this.stats_interval),delete this.stats_interval}getMos(e){let t=0,r=0,n=0,i=0,o=0,s=0,a=0;for(let i of e.values())"inbound-rtp"===i.type&&(t=i.jitter,n=i.packetsLost,r=i.packetsReceived);return r+n>0&&(i=n/(r+n)*100),s=(o=100+2*t+10)<160?93.2-o/40:93.2-(o-120)/10,(s-=2.5*i)<1&&(s=1),a=1+.035*s+7e-6*s*(s-60)*(100-s),this.updateMOSReport(a),RTCStats.normaliseFloat(a)}updateMOSReport(e){return this._reportsCount++,this._mosSum+=e,this.mos_report.last=e,this.mos_report.min=e<this.mos_report.min?e:this.mos_report.min,this.mos_report.max=e>this.mos_report.max?e:this.mos_report.max,this.mos_report.average=this._mosSum/this._reportsCount,this.mos_report}getMOSReport(){return this.mos_report.min=RTCStats.normaliseFloat(this.mos_report.min),this.mos_report.max=RTCStats.normaliseFloat(this.mos_report.max),this.mos_report.last=RTCStats.normaliseFloat(this.mos_report.last),this.mos_report.average=RTCStats.normaliseFloat(this.mos_report.average),this.mos_report}static normaliseFloat(e){return parseFloat(e).toFixed(6)}}t.exports=RTCStats},{"./rtcstats-reporter":17}],19:[function(e,t,r){t.exports=function(e){let t=[],r=new WebSocket(e+window.location.pathname,"1.0");return r.onerror=function(e){},r.onopen=function(){for(;t.length;)r.send(JSON.stringify(t.shift()))},function trace(){let e=Array.prototype.slice.call(arguments);e.push((new Date).getTime()),1===r.readyState?r.send(JSON.stringify(e)):"getstats"!==e[0]&&t.push(e)}}},{}],20:[function(e,t,r){(function(r){const n=e("./nexmoClientErrorTypes");function decorateError(e,t){t&&t.code&&(t.type=t.code,delete t.code),Object.assign(e,t),e.message="type: "+e.type+", description: "+(e.description?e.description:""),e.stack=(new Error).stack}function NexmoClientError(e){const t=n[e];t?decorateError(this,t):(this.message=e&&e.message?e.message:e,this.stack=e&&e.stack?e.stack:(new Error).stack),this.name="NexmoClientError",void 0!==r.NXMbugsnagClient&&r.NXMbugsnagClient.notify(this,{severity:"info"})}function NexmoApiError(e){decorateError(this,e),this.name="NexmoApiError",void 0!==r.NXMbugsnagClient&&r.NXMbugsnagClient.notify(this,{severity:"info",metaData:{"API trace":e.__metadata,rid:e.rid}})}NexmoClientError.prototype=Object.create(NexmoClientError.prototype),NexmoClientError.prototype.constructor=NexmoClientError,NexmoApiError.prototype=Object.create(NexmoApiError.prototype),NexmoApiError.prototype.constructor=NexmoApiError,t.exports={NexmoClientError:NexmoClientError,NexmoApiError:NexmoApiError}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./nexmoClientErrorTypes":21}],21:[function(e,t,r){t.exports={"error:application:call:params":{type:"error:application:call:params",description:"not a valid String[] of usernames param"},"error:application:callServer:params":{type:"error:application:call:params",description:"not a valid String of phone number"},"error:call:reject":{type:"error:call:reject",description:"failed to reject the call"},"error:getUserMedia:permissions":{type:"error:getUserMedia:permissions",description:"missing getUserMedia permissions"},"error:media:params":{type:"error:media:params",description:"currently supported params media type= {audio:{muted:false, earmuffed:false}}"},"error:self":{type:"error:self",description:"Conversation Object is missing self (me)"},"error:user:relogin":{type:"error:user:relogin",description:"please relogin"},"error:seen:own-message":{type:"error:seen:own-message",description:"attempt to send seen for own message"},"error:already-seen":{type:"error:already-seen",description:"already marked as seen"},"error:delivered:own-message":{type:"error:delivered:own-message",description:"attempt to send delivered for own message"},"error:already-delivered":{type:"error:already-delivered",description:"already marked as delivered"},"error:fetch-image":{type:"error:fetch-image",description:"xhr.status received other than 200"},"error:delete-image":{type:"error:delete-image",description:"xhr.status received other than 204"},"error:missing:params":{type:"error:missing:params",description:"missing parameters"},"error:invite:missing:params":{type:"error:missing:params",description:"This invite cannot be sent to empty username and user_id"},"error:invalid:param:type":{type:"error:invalid:param:type",description:"Invalid Object type, passed in the parameters"},"error:audio:already-connecting":{type:"error:audio:already-connecting",description:"Audio call already in progress"},"error:audio:not-enabled":{type:"error:audio:not-enabled",description:"Audio is not enabled"},"error:media:already-connecting":{type:"error:media:already-connecting",description:"Media is already in progress"},"error:media:unsupported-browser":{type:"error:media:unsupported-browser",description:"This action is not supported on this browser"},"error:media:extension":{type:"error:media:extension",description:"Chrome extension has thrown an error"},"error:media:extension-not-installed":{type:"error:media:extension-not-installed",description:"Chrome extension should be installed"},"error:media:update:streams":{type:"error:media:update:streams",description:"cant update more than one stream"},"error:media:update:unsupported":{type:"error:media:update:unsupported",description:"params are not valid for update - need video or screenshare"},"error:media:update:invalid":{type:"error:media:update:invalid",description:"state of media is not supported for this update"},"error:media:stream:not-found":{type:"error:media:stream:not-found",description:"A stream with the given index was not found"},"error:audio:dtmf:invalid-digit":{type:"error:audio:dtmf:invalid-digit",description:"not a valid string of dtmf digits (0-9,a-d,A-D,p,P,*,#)"},"error:invalid-order":{type:"error:invalid-order",description:"params not valid. Order must be asc or desc"},"error:custom-event:invalid":{type:"error:custom-event:invalid",description:"Custom event type not valid"}}},{}],22:[function(e,t,r){const n=e("./page");t.exports=class ConversationsPage extends n{constructor(e){super(e),this.items=new Map,e.items.forEach(e=>{const t=this.application.updateOrCreateConversation(e);this.items.set(t.id,t)})}getPrev(){return this.hasPrev()?this.application.getConversations(this._getConfig(this.cursor.prev)):this._getError()}getNext(){return this.hasNext()?this.application.getConversations(this._getConfig(this.cursor.next)):this._getError()}}},{"./page":24}],23:[function(e,t,r){const n=e("./page"),i=e("../events/nxmEvent"),o=e("../events/text_event"),s=e("../events/image_event");t.exports=class EventsPage extends n{constructor(e){super(e),this.items=new Map,this.conversation=e.conversation,e.items.forEach(e=>{switch(e.type){case"text":this.items.set(e.id,new o(this.conversation,e));break;case"image":this.items.set(e.id,new s(this.conversation,e));break;default:this.items.set(e.id,new i(this.conversation,e))}}),this.conversation.events=new Map([...this.conversation.events,...this.items])}getPrev(){return this.hasPrev()?this.conversation.getEvents(this._getConfig(this.cursor.prev)):this._getError()}getNext(){return this.hasNext()?this.conversation.getEvents(this._getConfig(this.cursor.next)):this._getError()}}},{"../events/image_event":3,"../events/nxmEvent":4,"../events/text_event":5,"./page":24}],24:[function(e,t,r){const n=e("../nexmoClientError").NexmoApiError;t.exports=class Page{constructor(e={}){this.page_size=e.page_size,this.order=e.order,this.cursor=e.cursor,this.application=e.application,e.event_type&&e.event_type.length>0&&(this.event_type=e.event_type)}hasPrev(){return!!this.cursor.prev&&this.cursor.prev.length>0}hasNext(){return!!this.cursor.next&&this.cursor.next.length>0}_getConfig(e){const t={page_size:this.page_size,order:this.order,cursor:e};return this.event_type&&(t.event_type=this.event_type),t}_getError(){return Promise.reject(new n({type:"error:invalid-cursor",description:"page does not exist"}))}}},{"../nexmoClientError":20}],25:[function(e,t,r){t.exports=class PageConfig{constructor(e={}){this.page_size=e.page_size||10,this.order=e.order||"asc",this.cursor=e.cursor||"",e.event_type&&(this.event_type=e.event_type)}}},{}],26:[function(e,t,r){(function(r){const n=e("wildemitter"),i=e("socket.io-client"),o=e("loglevel"),s=e("loglevel-plugin-prefix"),a=e("@bugsnag/js"),c=e("./utils"),u=e("./application"),d=e("./modules/errors_emitter"),p=e("./user"),l=e("./nexmoClientError").NexmoClientError,h=e("./nexmoClientError").NexmoApiError;s.reg(o),s.apply(o,{template:"[%t] %l (NXM-%n):",timestampFormatter:e=>e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),levelFormatter:e=>e.toUpperCase(),nameFormatter:e=>e||"SDK"});class NexmoClient{constructor(e){const t=e||{};this.config={debug:!1,callstats:{enabled:!1,AppID:"",AppSecret:""},log_reporter:{enabled:!1,bugsnag_key:null},environment:"production",ips_url:"https://api.nexmo.com/v1/image",nexmo_api_url:"https://api.nexmo.com",path:"/rtc",repository:"https://github.com/Nexmo/conversation-js-sdk",socket_io:{reconnection:!0,reconnectionAttempts:5,forceNew:!0,autoConnect:!0,transports:["websocket"]},screenShareExtensionId:"",SDK_version:"6.0.1",sync:"lite",url:"https://ws.nexmo.com",iceServers:[{urls:"stun:stun.l.google.com:19302"}],rtcstats:{ws_url:"",emit_events:!1},conversations_page_config:{page_size:10,order:"asc",cursor:""},events_page_config:{page_size:10,order:"asc",event_type:""}},this.sessionReady=!1,this.session_id=null,this.requests={},this.application=null,!0===t.debug?o.setLevel("debug"):o.setLevel("silent"),this.log=o.noConflict(),this.config=c.deepMergeObj(this.config,this._sanitizeConfig(t)),this.config.callstats.enabled&&c.injectScript("//api.callstats.io/static/callstats.min.js",()=>{"undefined"!=typeof callstats&&(this.callstats=new callstats)}),this.config.log_reporter.enabled&&(r.NXMbugsnagClient=a({apiKey:this.config.log_reporter.bugsnag_key||c._getBugsnagKey(),appVersion:this.config.SDK_version,releaseStage:this.config.environment})),this._createAndSetConnection(),n.mixin(NexmoClient)}_createAndSetConnection(){let e,t=Object.assign({path:this.config.path},this.config.socket_io);return e=i.connect(this.config.url,t),this.connection=e,e.on("connect",()=>{this.emit("ready"),this.sessionReady=!0,this.log.info("websocket ready")}),e.on("connecting",()=>{this.emit("connecting"),this.log.info("websocket connecting")}),e.on("disconnect",()=>{this.emit("disconnect"),this.log.info("websocket disconnected")}),e.on("reconnect",e=>{this.emit("reconnect",e),this.log.info("websocket reconnect")}),e.on("reconnecting",e=>{this.emit("reconnecting",e),this.log.info("websocket reconnecting")}),e.on("error",e=>{this.emit("error",new l(e)),this.log.error("Socket.io reported a generic error",e)}),e.io.on("packet",e=>{if(2!==e.type)return;if("echo"===e.data[0])return;const t=e.data[1];if(t.type=e.data[0],this.log.debug("<--",t.type,t),t.rid in this.requests){const e=this.requests[t.rid].callback;delete this.requests[t.rid],delete t.delay,this.errorsEmitter&&this.errorsEmitter.emitResponseIfError(t),e(t)}else this.application&&this.application._handleEvent(t)}),e}_sanitizeConfig(e){let t=e;return e.sync&&-1===["lite","full","none"].indexOf(e.sync)&&(this.log.warn(`invalid param '${e.sync}' for sync, reverting to ${this.config.sync}`),t.sync=this.config.sync),t}sendRequest(e,t){e.tid=c.allocateUUID();const r=e.type;delete e.type,this.log.debug("--\x3e",r,e),this.log.info("--\x3e",r,e.tid),this.connection.emit(r,e),this.requests[e.tid]={type:r,request:e,callback:t}}sendNetworkRequest(e){const t=e.version||"beta",r=`${this.config.nexmo_api_url}/${t}/${e.path}`;return"GET"!==e.type&&"DELETE"!==e.type&&(e.data?e.data.originating_session=this.session_id:e.data={originating_session:this.session_id}),new Promise((t,n)=>c.networkRequest({type:e.type,url:r,data:e.data?e.data:null,token:(e.data||{}).token?e.data.token:this.config.token||null}).then(({response:e})=>{t(e)}).catch(({response:e})=>{n(e)}))}login(e){return void 0===this.connection&&this._createAndSetConnection(),new Promise((t,n)=>{this.log.info(`Client-SDK Version: ${this.config.SDK_version}`),c.cleanupToken(),this.sendRequest({type:"session:login",body:{token:e,SDK_version:this.config.SDK_version,OS_family:"js",OS_revision:"undefined"!=typeof navigator?navigator.userAgent:"undefined"!=typeof window?window.navigator.userAgent:"Generic JS navigator"}},i=>{if("session:success"===i.type){if(this.session_id=i.body.id,this.config.token=this.config.nexmo_api_url.includes("npe")?e:null,(!this.application||this.application.me&&this.application.me.id!==i.body.user_id)&&(this.application=new u(this)),this.application.me||(this.application.me=new p(this.application,{id:i.body.user_id,name:i.body.name})),this.errorsEmitter||(this.errorsEmitter=new d(this.application)),void 0!==this.callstats){const e=(e,t)=>{this.log.info(`Status: errCode= ${e} errMsg= ${t}`)},t={inbound:"inbound",outbound:"outbound"},r=e=>{let r;for(r in e.streams){this.log.info("SSRC is: ",r);let n=e.streams[r];this.log.info("SSRC Type ",n.reportType),n.reportType===t.outbound?this.log.info("RTT is: ",n.rtt):n.reportType===t.inbound&&this.log.info("Inbound loss rate is: ",n.fractionLoss)}},n={disableBeforeUnloadHandler:!0,applicationVersion:this.config.SDK_version,disablePrecalltest:!0};this.callstats.initialize(this.config.callstats.AppID,this.config.callstats.AppSecret,this.application.me.id,e,r,n)}return this.config.log_reporter.enabled&&(r.NXMbugsnagClient.user={id:this.application.me.id,name:this.application.me.name,session_id:i.body.id}),this._updateTokenInStorage(e,i.body.name).then(e=>{if("none"!==this.config.sync)return this.application.getConversations().then(()=>{t(this.application)}).catch(e=>{n(e)});t(this.application)})}n(new h(i))})})}logout(){return new Promise((e,t)=>{const r=()=>this.sendRequest({type:"session:logout",body:{}},r=>{"session:logged-out"===r.type||"session:terminated"===r.type?(this.disconnect(),delete this.errorsEmitter,delete this.application,delete this.connection,this.callbacks={},this.requests={},this.sessionReady=!1,e(r)):t(r)});if(this.application){let e=[];if(this.application.conversations.size)for(let t of this.application.conversations.values())e.push(t.media.disable());return Promise.all(e).catch(e=>{this.log.info(e)}).then(()=>r())}return r()})}disconnect(){return this.connection.disconnect()}connect(){return this.connection.connect()}_updateTokenInStorage(e,t){return Promise.resolve(c.updateToken({token:e,username:t}))}}t.exports=NexmoClient}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./application":1,"./modules/errors_emitter":13,"./nexmoClientError":20,"./user":27,"./utils":28,"@bugsnag/js":30,loglevel:52,"loglevel-plugin-prefix":51,"socket.io-client":59,wildemitter:100}],27:[function(e,t,r){const n=e("wildemitter");class User{constructor(e,t){this.application=e,Object.assign(this,t),n.mixin(User)}}t.exports=User},{wildemitter:100}],28:[function(e,t,r){const n=e("uuid"),i=e("./nexmoClientError").NexmoClientError;class Utils{static getMemberFromNameOrNull(e,t){if(!e||!t)return null;for(let r of e.members.values())if(r.user.name===t)return r;return null}static getMemberNumberFromEventOrNull(e){const t=e&&e.from;return t&&(t.number||t.uri)?t.number||t.uri:null}static networkRequest(e){return Utils.getToken(e.token).then(t=>new Promise((r,n)=>{const i=new XMLHttpRequest;let o;i.open(e.type,e.url,!0),i.setRequestHeader("Authorization","Bearer "+t),e&&e.url.includes("image")?(i.responseType="",o=e.data,i.onloadstart=(()=>{r(i)})):(i.responseType=e.responseType||"json",o=JSON.stringify(e.data)||null,i.setRequestHeader("Content-type","application/json; charset=utf-8")),i.onload=(()=>{200===i.status||204===i.status?r(i):n(i)}),i.onerror=(e=>{n(e)}),i.send(o)}))}static paginationRequest(e,t){return Utils.networkRequest({type:"GET",url:Utils.addUrlSearchParams(e,t)}).then(r=>{const{page_size:n,_embedded:i,_links:o}=r.response,s=e.split("/").pop().trim(),a={items:i.data[s],cursor:{prev:o.prev?new URLSearchParams(o.prev.href).get("cursor"):"",next:o.next?new URLSearchParams(o.next.href).get("cursor"):"",self:o.self?new URLSearchParams(o.self.href).get("cursor"):""},page_size:n,order:t.order||"asc"};return t.event_type&&(a.event_type=t.event_type),Promise.resolve(a)}).catch(({response:e})=>{const t=e||{type:"error:network:get-request",description:"network error on nexmo get request"};return t.validation&&(t.description=t.validation[Object.keys(t.validation)[0]]),Promise.reject(t)})}static addUrlSearchParams(e,t={}){let r=new URL(e);return Object.keys(t).forEach(e=>{!t[e]||"string"==typeof t[e]&&t[e].length<1||null===t[e]||r.searchParams.set(e,t[e])}),r.href}static deepMergeObj(e,t){const r=JSON.parse(JSON.stringify(e));for(let e in t)"[object Object]"===Object.prototype.toString.call(t[e])?r[e]=Utils.deepMergeObj(r[e],t[e]):r[e]=t[e];return r}static getToken(e){return e?Promise.resolve(e):localStorage.getItem("NXMO_user_data")?Promise.resolve(JSON.parse(localStorage.getItem("NXMO_user_data")).token):Promise.reject(new i("error:user:relogin"))}static getUsername(){return localStorage.getItem("NXMO_user_data")?Promise.resolve(JSON.parse(localStorage.getItem("NXMO_user_data")).username):Promise.resolve("")}static updateToken(e){if("undefined"==typeof Storage)return Promise.reject(new i("Storage not supported"));Utils.getUsername().then(t=>t===e.username||""===t?(localStorage.setItem("NXMO_user_data",JSON.stringify(e)),Promise.resolve()):Promise.reject(new i("error:user:inconsistent-user")))}static cleanupToken(){"undefined"!=typeof Storage&&localStorage.removeItem("NXMO_user_data")}static injectScript(e,t){if("undefined"!=typeof document){let r=document.getElementsByTagName("head")[0],n=document.createElement("script");n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){n.readyState&&!/loaded|complete/.test(n.readyState)||(n.onload=n.onreadystatechange=null,n=null,t&&t())},r.insertBefore(n,r.firstChild)}}static allocateUUID(){return n.v4()}static validateDTMF(e){return"string"==typeof e&&/^[\da-dA-D#*pP]{1,45}$$/.test(e)}static _getBugsnagKey(){return"76498fc1ca8d9b0a173a44e2b873d7ed"}static updateMemberLegs(e,t){if(e){const r=e.find(e=>e.leg_id===t.body.leg_id);if(r){if(r.status!==t.body.status){let n=e.indexOf(r);e.fill(r.status=t.body.status,n,n++)}}else e.push({leg_id:t.body.leg_id,status:t.body.status})}else e=[{leg_id:t.body.leg_id,status:t.body.status}];return e}}t.exports=Utils},{"./nexmoClientError":20,uuid:80}],29:[function(e,t,r){(function(e){!function(n){if("object"==typeof r&&void 0!==t)t.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).bugsnag=n()}}(function(){var e=function(e,t,r){for(var n=r,i=0,o=e.length;i<o;i++)n=t(n,e[i],i,e);return n},t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=function(e){return e<10?"0"+e:e},i=function(t,r){return e(t,function(e,t,n,i){return e.concat(r(t,n,i))},[])},o=e,s=function(t,r){return e(t,function(e,t,n,i){return r(t,n,i)?e.concat(t):e},[])},a=function(t,r){return e(t,function(e,t,n,i){return!0===e||t===r},!1)},c=function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=function(){var e=new Date;return e.getUTCFullYear()+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())+"T"+n(e.getUTCHours())+":"+n(e.getUTCMinutes())+":"+n(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},d={intRange:function(e,t){return void 0===e&&(e=1),void 0===t&&(t=1/0),function(r){return"number"==typeof r&&parseInt(""+r,10)===r&&r>=e&&r<=t}},stringWithLength:function(e){return"string"==typeof e&&!!e.length}},p={},l=s,h=o,f=function(e){var n,i=[];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.push(n);if(!t)return i;for(var o=0,s=r.length;o<s;o++)Object.prototype.hasOwnProperty.call(e,r[o])&&i.push(r[o]);return i},m=c,g=a,v=d.intRange,y=d.stringWithLength;function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}p.schema={apiKey:{defaultValue:function(){return null},message:"is required",validate:y},appVersion:{defaultValue:function(){return null},message:"should be a string",validate:function(e){return null===e||y(e)}},appType:{defaultValue:function(){return null},message:"should be a string",validate:function(e){return null===e||y(e)}},autoNotify:{defaultValue:function(){return!0},message:"should be true|false",validate:function(e){return!0===e||!1===e}},beforeSend:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:function(e){return"function"==typeof e||m(e)&&l(e,function(e){return"function"==typeof e}).length===e.length}},endpoints:{defaultValue:function(){return{notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}},message:"should be an object containing endpoint URLs { notify, sessions }. sessions is optional if autoCaptureSessions=false",validate:function(e,t){return e&&"object"==typeof e&&y(e.notify)&&(!1===t.autoCaptureSessions||y(e.sessions))&&0===l(f(e),function(e){return!g(["notify","sessions"],e)}).length}},autoCaptureSessions:{defaultValue:function(e,t){return void 0===t.endpoints||!!t.endpoints&&!!t.endpoints.sessions},message:"should be true|false",validate:function(e){return!0===e||!1===e}},notifyReleaseStages:{defaultValue:function(){return null},message:"should be an array of strings",validate:function(e){return null===e||m(e)&&l(e,function(e){return"string"==typeof e}).length===e.length}},releaseStage:{defaultValue:function(){return"production"},message:"should be a string",validate:function(e){return"string"==typeof e&&e.length}},maxBreadcrumbs:{defaultValue:function(){return 20},message:"should be a number ≤40",validate:function(e){return v(0,40)(e)}},autoBreadcrumbs:{defaultValue:function(){return!0},message:"should be true|false",validate:function(e){return"boolean"==typeof e}},user:{defaultValue:function(){return null},message:"(object) user should be an object",validate:function(e){return"object"==typeof e}},metaData:{defaultValue:function(){return null},message:"should be an object",validate:function(e){return"object"==typeof e}},logger:{defaultValue:function(){},message:"should be null or an object with methods { debug, info, warn, error }",validate:function(e){return!e||e&&h(["debug","info","warn","error"],function(t,r){return t&&"function"==typeof e[r]},!0)}},filters:{defaultValue:function(){return["password"]},message:"should be an array of strings|regexes",validate:function(e){return m(e)&&e.length===l(e,function(e){return"string"==typeof e||e&&"function"==typeof e.test}).length}}},p.mergeDefaults=function(e,t){if(!e||!t)throw new Error("opts and schema objects are required");return h(f(t),function(r,n){return r[n]=void 0!==e[n]?e[n]:t[n].defaultValue(e[n],e),r},{})},p.validate=function(e,t){if(!e||!t)throw new Error("opts and schema objects are required");var r=h(f(t),function(r,n){return t[n].validate(e[n],e)?r:r.concat({key:n,message:t[n].message,value:e[n]})},[]);return{valid:!r.length,errors:r}};var b=p.schema,S=i,_={releaseStage:{defaultValue:function(){return/^localhost(:\d+)?$/.test(window.location.host)?"development":"production"},message:"should be set",validate:d.stringWithLength},logger:_extends({},b.logger,{defaultValue:function(){return"undefined"!=typeof console&&"function"==typeof console.debug?w():void 0}})},w=function(){var e={},t=console.log;return S(["debug","info","warn","error"],function(r){var n=console[r];e[r]="function"==typeof n?n.bind(console,"[bugsnag]"):t.bind(console,"[bugsnag]")}),e},C=u,E=function(){function BugsnagBreadcrumb(e,t,r,n){void 0===e&&(e="[anonymous]"),void 0===t&&(t={}),void 0===r&&(r="manual"),void 0===n&&(n=C()),this.type=r,this.name=e,this.metaData=t,this.timestamp=n}return BugsnagBreadcrumb.prototype.toJSON=function toJSON(){return{type:this.type,name:this.name,timestamp:this.timestamp,metaData:this.metaData}},BugsnagBreadcrumb}(),T=function(e){return e.app&&"string"==typeof e.app.releaseStage?e.app.releaseStage:e.config.releaseStage};var k=function isError(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},R=function(e,t){return e.isIgnored()||!1===t},P={};!function(e,t){"use strict";"object"==typeof P?P=t():e.StackFrame=t()}(this,function(){"use strict";function _isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function _capitalize(e){return e.charAt(0).toUpperCase()+e.substring(1)}function _getter(e){return function(){return this[e]}}var e=["isConstructor","isEval","isNative","isToplevel"],t=["columnNumber","lineNumber"],r=["fileName","functionName","source"],n=e.concat(t,r,["args"]);function StackFrame(e){if(e instanceof Object)for(var t=0;t<n.length;t++)e.hasOwnProperty(n[t])&&void 0!==e[n[t]]&&this["set"+_capitalize(n[t])](e[n[t]])}StackFrame.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof StackFrame)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new StackFrame(e)}},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(_isNumber(this.getLineNumber())?":"+this.getLineNumber():"")+(_isNumber(this.getColumnNumber())?":"+this.getColumnNumber():"")}};for(var i=0;i<e.length;i++)StackFrame.prototype["get"+_capitalize(e[i])]=_getter(e[i]),StackFrame.prototype["set"+_capitalize(e[i])]=function(e){return function(t){this[e]=Boolean(t)}}(e[i]);for(var o=0;o<t.length;o++)StackFrame.prototype["get"+_capitalize(t[o])]=_getter(t[o]),StackFrame.prototype["set"+_capitalize(t[o])]=function(e){return function(t){if(!_isNumber(t))throw new TypeError(e+" must be a Number");this[e]=Number(t)}}(t[o]);for(var s=0;s<r.length;s++)StackFrame.prototype["get"+_capitalize(r[s])]=_getter(r[s]),StackFrame.prototype["set"+_capitalize(r[s])]=function(e){return function(t){this[e]=String(t)}}(r[s]);return StackFrame});var x={};!function(e,t){"use strict";"object"==typeof x?x=t(P):e.ErrorStackParser=t(e.StackFrame)}(this,function ErrorStackParser(e){"use strict";var t=/(^|@)\S+\:\d+/,r=/^\s*at .*(\S+\:\d+|\(native\))/m,n=/^(eval@)?(\[native code\])?$/;return{parse:function ErrorStackParser$$parse(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(r))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function ErrorStackParser$$extractLocation(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(e.replace(/[\(\)]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function ErrorStackParser$$parseV8OrIE(t){return t.stack.split("\n").filter(function(e){return!!e.match(r)},this).map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var r=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),n=this.extractLocation(r.pop()),i=r.join(" ")||void 0,o=["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0];return new e({functionName:i,fileName:o,lineNumber:n[1],columnNumber:n[2],source:t})},this)},parseFFOrSafari:function ErrorStackParser$$parseFFOrSafari(t){return t.stack.split("\n").filter(function(e){return!e.match(n)},this).map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var r=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=t.match(r),i=n&&n[1]?n[1]:void 0,o=this.extractLocation(t.replace(r,""));return new e({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})},this)},parseOpera:function ErrorStackParser$$parseOpera(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function ErrorStackParser$$parseOpera9(t){for(var r=/Line (\d+).*script (?:in )?(\S+)/i,n=t.message.split("\n"),i=[],o=2,s=n.length;o<s;o+=2){var a=r.exec(n[o]);a&&i.push(new e({fileName:a[2],lineNumber:a[1],source:n[o]}))}return i},parseOpera10:function ErrorStackParser$$parseOpera10(t){for(var r=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=t.stacktrace.split("\n"),i=[],o=0,s=n.length;o<s;o+=2){var a=r.exec(n[o]);a&&i.push(new e({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:n[o]}))}return i},parseOpera11:function ErrorStackParser$$parseOpera11(r){return r.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var r,n=t.split("@"),i=this.extractLocation(n.pop()),o=n.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(r=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===r||"[arguments not available]"===r?void 0:r.split(",");return new e({functionName:s,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})},this)}}});var O=x,A=function(e){return!(!e||!e.stack&&!e.stacktrace&&!e["opera#sourceloc"]||"string"!=typeof(e.stack||e.stacktrace||e["opera#sourceloc"])||e.stack===e.name+": "+e.message)},B={};function ___extends_23(){return(___extends_23=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}!function(e,t){"use strict";"object"==typeof B?B=t(P):e.StackGenerator=t(e.StackFrame)}(this,function(e){return{backtrace:function StackGenerator$$backtrace(t){var r=[],n=10;"object"==typeof t&&"number"==typeof t.maxStackSize&&(n=t.maxStackSize);for(var i=arguments.callee;i&&r.length<n&&i.arguments;){for(var o=new Array(i.arguments.length),s=0;s<o.length;++s)o[s]=i.arguments[s];/function(?:\s+([\w$]+))+\s*\(/.test(i.toString())?r.push(new e({functionName:RegExp.$1||void 0,args:o})):r.push(new e({args:o}));try{i=i.caller}catch(e){break}}return r}}});var M=o,I=s,D=function(){function BugsnagReport(e,t,r,n,i){void 0===r&&(r=[]),void 0===n&&(n=j()),this.__isBugsnagReport=!0,this._ignored=!1,this._handledState=n,this.app=void 0,this.apiKey=void 0,this.breadcrumbs=[],this.context=void 0,this.device=void 0,this.errorClass=U(e,"[no error class]"),this.errorMessage=U(t,"[no error message]"),this.groupingHash=void 0,this.metaData={},this.request=void 0,this.severity=this._handledState.severity,this.stacktrace=M(r,function(e,t){var r=N(t);try{return"{}"===JSON.stringify(r)?e:e.concat(r)}catch(t){return e}},[]),this.user=void 0,this.session=void 0,this.originalError=i}var e=BugsnagReport.prototype;return e.ignore=function ignore(){this._ignored=!0},e.isIgnored=function isIgnored(){return this._ignored},e.updateMetaData=function updateMetaData(e){var t,r;return e?null===(arguments.length<=1?void 0:arguments[1])?this.removeMetaData(e):null===(arguments.length<=2?void 0:arguments[2])?this.removeMetaData(e,arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):("object"==typeof(arguments.length<=1?void 0:arguments[1])&&(r=arguments.length<=1?void 0:arguments[1]),"string"==typeof(arguments.length<=1?void 0:arguments[1])&&((t={})[arguments.length<=1?void 0:arguments[1]]=arguments.length<=2?void 0:arguments[2],r=t),r?(this.metaData[e]||(this.metaData[e]={}),this.metaData[e]=___extends_23({},this.metaData[e],r),this):this):this},e.removeMetaData=function removeMetaData(e,t){return"string"!=typeof e?this:t?this.metaData[e]?(delete this.metaData[e][t],this):this:(delete this.metaData[e],this)},e.toJSON=function toJSON(){return{payloadVersion:"4",exceptions:[{errorClass:this.errorClass,message:this.errorMessage,stacktrace:this.stacktrace,type:"browserjs"}],severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,breadcrumbs:this.breadcrumbs,context:this.context,user:this.user,metaData:this.metaData,groupingHash:this.groupingHash,request:this.request,session:this.session}},BugsnagReport}(),N=function(e){var t={file:e.fileName,method:L(e.functionName),lineNumber:e.lineNumber,columnNumber:e.columnNumber,code:void 0,inProject:void 0};return t.lineNumber>-1&&!t.file&&!t.method&&(t.file="global code"),t},L=function(e){return/^global code$/i.test(e)?"global code":e},j=function(){return{unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}},U=function(e,t){return"string"==typeof e&&e?e:t};D.getStacktrace=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=0),A(e)?O.parse(e).slice(t):I(B.backtrace(),function(e){return-1===(e.functionName||"").indexOf("StackGenerator$$")}).slice(1+r)},D.ensureReport=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=0),e.__isBugsnagReport)return e;try{var n=D.getStacktrace(e,t,1+r);return new D(e.name,e.message,n,void 0,e)}catch(t){return new D(e.name,e.message,[],void 0,e)}};var F=D,q=function pad(e,t){var r="000000000"+e;return r.substr(r.length-t)},W="object"==typeof window?window:self,G=0;for(var z in W)Object.hasOwnProperty.call(W,z)&&G++;var H=navigator.mimeTypes?navigator.mimeTypes.length:0,$=q((H+navigator.userAgent.length).toString(36)+G.toString(36),4),V=function fingerprint(){return $},J=0,X=4,K=36,Y=Math.pow(K,X);function randomBlock(){return q((Math.random()*Y<<0).toString(K),X)}function cuid(){return"c"+(new Date).getTime().toString(K)+q(function safeCounter(){return J=J<Y?J:0,++J-1}().toString(K),X)+V()+(randomBlock()+randomBlock())}cuid.fingerprint=V;var Q=cuid,Z=u,ee=function(){function Session(){this.id=Q(),this.startedAt=Z(),this._handled=0,this._unhandled=0}var e=Session.prototype;return e.toJSON=function toJSON(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}},e.trackError=function trackError(e){this[e._handledState.unhandled?"_unhandled":"_handled"]+=1},Session}();function ___extends_4(){return(___extends_4=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var te=i,re=a,ne=c,ie=function(){function BugsnagClient(e){if(!(e&&e.name&&e.version&&e.url))throw new Error("`notifier` argument is required");this.notifier=e,this._configured=!1,this._opts={},this.config={},this._delivery={sendSession:function(){},sendReport:function(){}},this._logger={debug:function(){},info:function(){},warn:function(){},error:function(){}},this._plugins={},this._session=null,this.breadcrumbs=[],this.app={},this.context=void 0,this.device=void 0,this.metaData=void 0,this.request=void 0,this.user={},this.BugsnagClient=BugsnagClient,this.BugsnagReport=F,this.BugsnagBreadcrumb=E,this.BugsnagSession=ee;var t=this,r=this.notify;this.notify=function(){return r.apply(t,arguments)}}var e=BugsnagClient.prototype;return e.setOptions=function setOptions(e){this._opts=___extends_4({},this._opts,e)},e.configure=function configure(e){void 0===e&&(e=p.schema);var t=p.mergeDefaults(this._opts,e),r=p.validate(t,e);if(!0==!r.valid)throw new Error(ae(r.errors));return"function"==typeof t.beforeSend&&(t.beforeSend=[t.beforeSend]),t.appVersion&&(this.app.version=t.appVersion),t.appType&&(this.app.type=t.appType),t.metaData&&(this.metaData=t.metaData),t.user&&(this.user=t.user),t.logger&&this.logger(t.logger),this.config=___extends_4({},this.config,t),this._configured=!0,this},e.use=function use(e){if(!this._configured)throw new Error("client not configured");e.configSchema&&this.configure(e.configSchema);for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=e.init.apply(e,[this].concat(r));return e.name&&(this._plugins["~"+e.name+"~"]=i),this},e.getPlugin=function getPlugin(e){return this._plugins["~"+e+"~"]},e.delivery=function delivery(e){return this._delivery=e,this},e.logger=function logger(e,t){return this._logger=e,this},e.sessionDelegate=function sessionDelegate(e){return this._sessionDelegate=e,this},e.startSession=function startSession(){return this._sessionDelegate?this._sessionDelegate.startSession(this):(this._logger.warn("No session implementation is installed"),this)},e.leaveBreadcrumb=function leaveBreadcrumb(e,t,r,n){if(!this._configured)throw new Error("client not configured");if(e=e||void 0,r="string"==typeof r?r:void 0,n="string"==typeof n?n:void 0,t="object"==typeof t&&null!==t?t:void 0,"string"==typeof e||t){var i=new E(e,t,r,n);return this.breadcrumbs.push(i),this.breadcrumbs.length>this.config.maxBreadcrumbs&&(this.breadcrumbs=this.breadcrumbs.slice(this.breadcrumbs.length-this.config.maxBreadcrumbs)),this}},e.notify=function notify(e,t,r){var n=this;if(void 0===t&&(t={}),void 0===r&&(r=function(){}),!this._configured)throw new Error("client not configured");var i=T(this),o=oe(e,t,this._logger),s=o.err,a=o.errorFramesToSkip,c=o._opts;c&&(t=c),"object"==typeof t&&null!==t||(t={});var u=F.ensureReport(s,a,2);if(u.app=___extends_4({},{releaseStage:i},u.app,this.app),u.context=u.context||t.context||this.context||void 0,u.device=___extends_4({},u.device,this.device,t.device),u.request=___extends_4({},u.request,this.request,t.request),u.user=___extends_4({},u.user,this.user,t.user),u.metaData=___extends_4({},u.metaData,this.metaData,t.metaData),u.breadcrumbs=this.breadcrumbs.slice(0),this._session&&(this._session.trackError(u),u.session=this._session),void 0!==t.severity&&(u.severity=t.severity,u._handledState.severityReason={type:"userSpecifiedSeverity"}),ne(this.config.notifyReleaseStages)&&!re(this.config.notifyReleaseStages,i))return this._logger.warn("Report not sent due to releaseStage/notifyReleaseStages configuration"),r(null,u);var d=u.severity,p=function(e){n._logger.error("Error occurred in beforeSend callback, continuing anyway…"),n._logger.error(e)};!function(e,t,r){var n=e.length,i=0,o=function(){if(i>=n)return r(null,!1);t(e[i],function(e,t){return e?r(e,!1):!0===t?r(null,!0):(i++,void o())})};o()}([].concat(t.beforeSend).concat(this.config.beforeSend),function(e,t){return function(r,n){if("function"!=typeof r)return n(null,!1);try{if(2!==r.length){var i=r(e);return i&&"function"==typeof i.then?i.then(function(t){return setTimeout(function(){return n(null,R(e,t))},0)},function(e){setTimeout(function(){return t(e),n(null,!1)})}):n(null,R(e,i))}r(e,function(r,i){if(r)return t(r),n(null,!1);n(null,R(e,i))})}catch(e){t(e),n(null,!1)}}}(u,p),function(e,t){if(e&&p(e),t)return n._logger.debug("Report not sent due to beforeSend callback"),r(null,u);n.config.autoBreadcrumbs&&n.leaveBreadcrumb(u.errorClass,{errorClass:u.errorClass,errorMessage:u.errorMessage,severity:u.severity},"error"),d!==u.severity&&(u._handledState.severityReason={type:"userCallbackSetSeverity"}),n._delivery.sendReport(n._logger,n.config,{apiKey:u.apiKey||n.config.apiKey,notifier:n.notifier,events:[u]},function(e){return r(e,u)})})},BugsnagClient}(),oe=function(e,t,r){var n,i,o=function(e){var t=ce(e);return r.warn("Usage error. "+t),new Error("Bugsnag usage error. "+t)},s=0;switch(typeof e){case"string":"string"==typeof t?(n=o("string/string"),i={metaData:{notifier:{notifyArgs:[e,t]}}}):(n=new Error(String(e)),s=3);break;case"number":case"boolean":n=new Error(String(e));break;case"function":n=o("function");break;case"object":null!==e&&(k(e)||e.__isBugsnagReport)?n=e:null!==e&&se(e)?((n=new Error(e.message||e.errorMessage)).name=e.name||e.errorClass,s=3):n=o(null===e?"null":"unsupported object");break;default:n=o("nothing")}return{err:n,errorFramesToSkip:s,_opts:i}},se=function(e){return!("string"!=typeof e.name&&"string"!=typeof e.errorClass||"string"!=typeof e.message&&"string"!=typeof e.errorMessage)},ae=function(e){return"Bugsnag configuration error\n"+te(e,function(e){return'"'+e.key+'" '+e.message+" \n    got "+ue(e.value)}).join("\n\n")},ce=function(e){return"notify() expected error/opts parameters, got "+e},ue=function(e){return"object"==typeof e?JSON.stringify(e):String(e)},de=ie,pe=function(e,t,r,n){var i=n&&n.filterKeys?n.filterKeys:[],o=n&&n.filterPaths?n.filterPaths:[];return JSON.stringify(function prepareObjForSerialization(e,t,r){var n=[],i=0;return function visit(e,o){function edgesExceeded(){return o.length>fe&&i>he}i++;if(o.length>le)return me;if(edgesExceeded())return me;if(null===e||"object"!=typeof e)return e;if(function find(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1}(n,e))return"[Circular]";n.push(e);if("function"==typeof e.toJSON)try{i--;var s=visit(e.toJSON(),o);return n.pop(),s}catch(e){return throwsMessage(e)}var a=function __isError_18(e){return e instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(e))}(e);if(a){i--;var c=visit({name:e.name,message:e.message},o);return n.pop(),c}if(function __isArray_18(e){return"[object Array]"===Object.prototype.toString.call(e)}(e)){for(var u=[],d=0,p=e.length;d<p;d++){if(edgesExceeded()){u.push(me);break}u.push(visit(e[d],o.concat("[]")))}return n.pop(),u}var l={};try{for(var h in e)if(Object.prototype.hasOwnProperty.call(e,h))if(isDescendent(r,o.join("."))&&shouldFilter(t,h))l[h]="[Filtered]";else{if(edgesExceeded()){l[h]=me;break}l[h]=visit(safelyGetProp(e,h),o.concat(h))}}catch(e){}n.pop();return l}(e,[])}(e,i,o),t,r)},le=20,he=25e3,fe=8,me="...";function throwsMessage(e){return"[Throws: "+(e?e.message:"?")+"]"}function isDescendent(e,t){for(var r=0,n=e.length;r<n;r++)if(0===t.indexOf(e[r]))return!0;return!1}function shouldFilter(e,t){for(var r=0,n=e.length;r<n;r++){if("string"==typeof e[r]&&e[r]===t)return!0;if(e[r]&&"function"==typeof e[r].test&&e[r].test(t))return!0}return!1}function safelyGetProp(e,t){try{return e[t]}catch(e){return throwsMessage(e)}}var ge={},ve=["events.[].app","events.[].metaData","events.[].user","events.[].breadcrumbs","events.[].request","events.[].device"],ye=["device","app","user"];ge.report=function(e,t){var r=pe(e,null,null,{filterPaths:ve,filterKeys:t});if(r.length>1e6&&(delete e.events[0].metaData,e.events[0].metaData={notifier:"WARNING!\nSerialized payload was "+r.length/1e6+"MB (limit = 1MB)\nmetaData was removed"},(r=pe(e,null,null,{filterPaths:ve,filterKeys:t})).length>1e6))throw new Error("payload exceeded 1MB limit");return r},ge.session=function(e,t){var r=pe(e,null,null,{filterPaths:ye,filterKeys:t});if(r.length>1e6)throw new Error("payload exceeded 1MB limit");return r};var be,Se=u;be=function(e){return void 0===e&&(e=window),{sendReport:function(t,r,n,i){void 0===i&&(i=function(){});var o=_e(r,"notify","4",e),s=new e.XDomainRequest;s.onload=function(){i(null)},s.open("POST",o),setTimeout(function(){try{s.send(ge.report(n,r.filters))}catch(e){t.error(e),i(e)}},0)},sendSession:function(t,r,n,i){void 0===i&&(i=function(){});var o=_e(r,"sessions","1",e),s=new e.XDomainRequest;s.onload=function(){i(null)},s.open("POST",o),setTimeout(function(){try{s.send(ge.session(n,r.filters))}catch(e){t.error(e),i(e)}},0)}}};var _e=function(e,t,r,n){return we(e.endpoints[t],n.location.protocol)+"?apiKey="+encodeURIComponent(e.apiKey)+"&payloadVersion="+r+"&sentAt="+encodeURIComponent(Se())},we=be._matchPageProtocol=function(e,t){return"http:"===t?e.replace(/^https:/,"http:"):e},Ce=u,Ee={init:function(e,t){void 0===t&&(t=window),e.config.beforeSend.unshift(function(e){e.context||(e.context=t.location.pathname)})}};function ___extends_28(){return(___extends_28=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Te=u,ke={init:function(e,t){void 0===t&&(t=navigator);var r={locale:t.browserLanguage||t.systemLanguage||t.userLanguage||t.language,userAgent:t.userAgent};e.device=___extends_28({},r,e.device),e.config.beforeSend.unshift(function(e){e.device=___extends_28({},e.device,{time:Te()})})}};function ___extends_29(){return(___extends_29=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Re={init:function(e,t){void 0===t&&(t=window),e.config.beforeSend.unshift(function(e){e.request&&e.request.url||(e.request=___extends_29({},e.request,{url:t.location.href}))})}};function ___extends_30(){return(___extends_30=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Pe=c,xe=a,Oe={init:function(e){return e.sessionDelegate(Ae)}},Ae={startSession:function(e){var t=e;t._session=new e.BugsnagSession;var r=T(t);return Pe(t.config.notifyReleaseStages)&&!xe(t.config.notifyReleaseStages,r)?(t._logger.warn("Session not sent due to releaseStage/notifyReleaseStages configuration"),t):t.config.endpoints.sessions?(t._delivery.sendSession(t._logger,t.config,{notifier:t.notifier,device:t.device,app:___extends_30({},{releaseStage:r},t.app),sessions:[{id:t._session.id,startedAt:t._session.startedAt,user:t.user}]}),t):(t._logger.warn("Session not sent due to missing endpoints.sessions configuration"),t)}};function ___extends_31(){return(___extends_31=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Be={init:function(e){e.config.collectUserIp||e.config.beforeSend.push(function(e){e.user&&void 0===e.user.id&&delete e.user.id,e.user=___extends_31({id:"[NOT COLLECTED]"},e.user),e.request=___extends_31({clientIp:"[NOT COLLECTED]"},e.request)})},configSchema:{collectUserIp:{defaultValue:function(){return!0},message:"should be true|false",validate:function(e){return!0===e||!1===e}}}},Me={},Ie=i,De=o,Ne=s;Me.init=function(e){var t=/^dev(elopment)?$/.test(e.config.releaseStage),r=!1===e.config.consoleBreadcrumbsEnabled,n=(!1===e.config.autoBreadcrumbs||t)&&!0!==e.config.consoleBreadcrumbsEnabled;r||n||Ie(Le,function(t){var r=console[t];console[t]=function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];e.leaveBreadcrumb("Console output",De(i,function(e,t,r){var n="[Unknown value]";try{n=String(t)}catch(e){}if("[object Object]"===n)try{n=JSON.stringify(t)}catch(e){}return e["["+r+"]"]=n,e},{severity:0===t.indexOf("group")?"log":t}),"log"),r.apply(console,i)},console[t]._restore=function(){console[t]=r}})},Me.configSchema={consoleBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}};var Le=Ne(["log","debug","info","warn","error"],function(e){return"undefined"!=typeof console&&"function"==typeof console[e]}),je={},Ue=o,Fe=/^.*<script.*?>/,qe=/<\/script>.*$/,We=(je={init:function(e,t,r){void 0===t&&(t=document),void 0===r&&(r=window);var n="",i=!1,o=function(){return t.documentElement.outerHTML},s=r.location.href;n=o();var a=t.onreadystatechange;t.onreadystatechange=function(){"interactive"===t.readyState&&(n=o(),i=!0),"function"==typeof a&&a.apply(this,arguments)},e.config.beforeSend.unshift(function(e){var t=e.stacktrace[0];if(!t||!t.file||!t.lineNumber)return t;if(t.file.replace(/#.*$/,"")!==s.replace(/#.*$/,""))return t;i&&n||(n=o());var r=["\x3c!-- DOC START --\x3e"].concat(n.split("\n")),a=We(r,t.lineNumber-1),c=a.script,u=a.start,d=Ue(c,function(e,r,n){return Math.abs(u+n+1-t.lineNumber)>10?e:(e[""+(u+n+1)]=r,e)},{});t.code=d,e.updateMetaData("script",{content:c.join("\n")})})}}).extractScriptContent=function(e,t){for(var r=t;r<e.length&&!qe.test(e[r]);)r++;for(var n=r;r>0&&!Fe.test(e[r]);)r--;var i=r,o=e.slice(i,n+1);return o[0]=o[0].replace(Fe,""),o[o.length-1]=o[o.length-1].replace(qe,""),{script:o,start:i}},Ge={init:function(e,t){if(void 0===t&&(t=window),"addEventListener"in t){var r=!1===e.config.interactionBreadcrumbsEnabled,n=!1===e.config.autoBreadcrumbs&&!0!==e.config.interactionBreadcrumbsEnabled;r||n||t.addEventListener("click",function(r){var n,i;try{n=ze(r.target),i=function getNodeSelector(e,t){var r=[e.tagName];e.id&&r.push("#"+e.id);e.className&&e.className.length&&r.push("."+e.className.split(" ").join("."));if(!t.document.querySelectorAll||!Array.prototype.indexOf)return r.join("");try{if(1===t.document.querySelectorAll(r.join("")).length)return r.join("")}catch(e){return r.join("")}if(e.parentNode.childNodes.length>1){var n=Array.prototype.indexOf.call(e.parentNode.childNodes,e)+1;r.push(":nth-child("+n+")")}if(1===t.document.querySelectorAll(r.join("")).length)return r.join("");if(e.parentNode)return getNodeSelector(e.parentNode,t)+" > "+r.join("");return r.join("")}(r.target,t)}catch(t){n="[hidden]",i="[hidden]",e._logger.error("Cross domain error when tracking click event. See docs: https://tinyurl.com/y94fq5zm")}e.leaveBreadcrumb("UI click",{targetText:n,targetSelector:i},"user")},!0)}},configSchema:{interactionBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}}},ze=function(e){var t=e.textContent||e.innerText||"";return t||"submit"!==e.type&&"button"!==e.type||(t=e.value),function truncate(e,t){return e&&e.length<=t?e:e.slice(0,t-"(...)".length)+"(...)"}(t=t.replace(/^\s+|\s+$/g,""),140)};var He,$e,Ve={init:function(e,t){if(void 0===t&&(t=window),"addEventListener"in t){var r=!1===e.config.navigationBreadcrumbsEnabled,n=!1===e.config.autoBreadcrumbs&&!0!==e.config.navigationBreadcrumbsEnabled;if(!r&&!n){var i=function(t){return function(){return e.leaveBreadcrumb(t,{},"navigation")}};t.addEventListener("pagehide",i("Page hidden"),!0),t.addEventListener("pageshow",i("Page shown"),!0),t.addEventListener("load",i("Page loaded"),!0),t.document.addEventListener("DOMContentLoaded",i("DOMContentLoaded"),!0),t.addEventListener("load",function(){return t.addEventListener("popstate",i("Navigated back"),!0)}),t.addEventListener("hashchange",function(r){var n=r.oldURL?{from:Je(r.oldURL,t),to:Je(r.newURL,t),state:Ke(t)}:{to:Je(t.location.href,t)};e.leaveBreadcrumb("Hash changed",n,"navigation")},!0),t.history.replaceState&&Xe(e,t.history,"replaceState",t),t.history.pushState&&Xe(e,t.history,"pushState",t),e.leaveBreadcrumb("Bugsnag loaded",{},"navigation")}}},configSchema:{navigationBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}}},Je=function(e,t){var r=t.document.createElement("A");return r.href=e,""+r.pathname+r.search+r.hash},Xe=function(e,t,r,n){var i=t[r];t[r]=function(o,s,a){e.leaveBreadcrumb("History "+r,function(e,t,r,n){var i=Je(e.location.href,e);return{title:r,state:t,prevState:Ke(e),to:n||i,from:i}}(n,o,s,a),"navigation"),"function"==typeof e.refresh&&e.refresh(),e.config.autoCaptureSessions&&e.startSession(),i.apply(t,[o,s].concat(void 0!==a?a:[]))},t[r]._restore=function(){t[r]=i}},Ke=function(e){try{return e.history.state}catch(e){}},Ye={},Qe="request",Ze="BS~~U",et="BS~~M",tt=a,rt=function(){return[He.config.endpoints.notify,He.config.endpoints.sessions]};Ye.init=function(e,t){void 0===t&&(t=window);var r=!1===e.config.networkBreadcrumbsEnabled,n=!1===e.config.autoBreadcrumbs&&!0!==e.config.networkBreadcrumbsEnabled;r||n||(He=e,$e=t,nt(),it())},Ye.configSchema={networkBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}};var nt=function(){if("addEventListener"in $e.XMLHttpRequest.prototype){var e=$e.XMLHttpRequest.prototype.open;$e.XMLHttpRequest.prototype.open=function open(t,r){this[Ze]=r,this[et]=t,this["BS~~S"]&&(this.removeEventListener("load",handleXHRLoad),this.removeEventListener("error",handleXHRError)),this.addEventListener("load",handleXHRLoad),this.addEventListener("error",handleXHRError),this["BS~~S"]=!0,e.apply(this,arguments)}}};function handleXHRLoad(){if(!tt(rt(),this[Ze])){var e={status:this.status,request:this[et]+" "+this[Ze]};this.status>=400?He.leaveBreadcrumb("XMLHttpRequest failed",e,Qe):He.leaveBreadcrumb("XMLHttpRequest succeeded",e,Qe)}}function handleXHRError(){tt(rt(),this[Ze])||He.leaveBreadcrumb("XMLHttpRequest error",{request:this[et]+" "+this[Ze]},Qe)}var it=function(){if("fetch"in $e){var e=$e.fetch;$e.fetch=function fetch(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r[0],o=r[1],s="GET";return o&&o.method&&(s=o.method),new Promise(function(t,n){e.apply(void 0,r).then(function(e){ot(e,s,i),t(e)}).catch(function(e){st(s,i),n(e)})})}}},ot=function(e,t,r){var n={status:e.status,request:t+" "+r};e.status>=400?He.leaveBreadcrumb("fetch() failed",n,Qe):He.leaveBreadcrumb("fetch() succeeded",n,Qe)},st=function(e,t){He.leaveBreadcrumb("fetch() error",{request:e+" "+t},Qe)},at=d.intRange,ct={init:function(e){var t=0;e.config.beforeSend.push(function(r){if(t>=e.config.maxEvents)return r.ignore();t++}),e.refresh=function(){t=0}},configSchema:{maxEvents:{defaultValue:function(){return 10},message:"should be a positive integer ≤100",validate:function(e){return at(1,100)(e)}}}},ut={};function ___extends_38(){return(___extends_38=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var dt=i,pt=(ut={init:function(e){e.config.beforeSend.push(function(e){e.stacktrace=dt(e.stacktrace,function(e){return ___extends_38({},e,{file:pt(e.file)})})})}})._strip=function(e){return"string"==typeof e?e.replace(/\?.*$/,"").replace(/#.*$/,""):e},lt={init:function(e,t){void 0===t&&(t=window);var r=t.onerror;t.onerror=function onerror(t,n,i,o,s){if(0===i&&/Script error\.?/.test(t))e._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/y94fq5zm");else{var a,c={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}};if(s)s.name&&s.message?a=new e.BugsnagReport(s.name,s.message,ht(e.BugsnagReport.getStacktrace(s),n,i,o),c,s):(a=new e.BugsnagReport("window.onerror",String(s),ht(e.BugsnagReport.getStacktrace(s,1),n,i,o),c,s)).updateMetaData("window onerror",{error:s});else if("object"!=typeof t||null===t||n&&"string"==typeof n||i||o||s)(a=new e.BugsnagReport("window.onerror",String(t),ht(e.BugsnagReport.getStacktrace(s,1),n,i,o),c,t)).updateMetaData("window onerror",{event:t});else{var u=t.type?"Event: "+t.type:"window.onerror",d=t.message||t.detail||"";(a=new e.BugsnagReport(u,d,e.BugsnagReport.getStacktrace(new Error,1).slice(1),c,t)).updateMetaData("window onerror",{event:t,extraParameters:n})}e.notify(a)}"function"==typeof r&&r.apply(this,arguments)}}},ht=function(e,t,r,n){var i=e[0];return i?(i.fileName||"string"!=typeof t||i.setFileName(t),!i.lineNumber&&ft(r)&&i.setLineNumber(r),i.columnNumber||(ft(n)?i.setColumnNumber(n):window.event&&ft(window.event.errorCharacter)&&i.setColumnNumber(window.event.errorCharacter)),e):e},ft=function(e){return"number"==typeof e&&"NaN"!==String.call(e)},mt={},gt=o;mt.init=function(e,t){void 0===t&&(t=window);var r=function(t){var r=t.reason,n=!1;try{t.detail&&t.detail.reason&&(r=t.detail.reason,n=!0)}catch(e){}var i,o={severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}};if(r&&A(r))i=new e.BugsnagReport(r.name,r.message,O.parse(r),o,r),n&&(i.stacktrace=gt(i.stacktrace,bt(r),[]));else{(i=new e.BugsnagReport(r&&r.name?r.name:"UnhandledRejection",r&&r.message?r.message:'Rejection reason was not an Error. See "Promise" tab for more detail.',[],o,r)).updateMetaData("promise","rejection reason",yt(r))}e.notify(i)};"addEventListener"in t?t.addEventListener("unhandledrejection",r):t.onunhandledrejection=function(e,t){r({detail:{reason:e,promise:t}})},r};var vt,yt=function(e){return null===e||void 0===e?"undefined (or null)":k(e)?((t={})[Object.prototype.toString.call(e)]={name:e.name,message:e.message,code:e.code,stack:e.stack},t):e;var t},bt=function(e){return function(t,r){return r.file===e.toString()?t:(r.method&&(r.method=r.method.replace(/^\s+/,"")),t.concat(r))}};function ___extends_2(){return(___extends_2=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var St=i,_t=___extends_2({},p.schema,_);return(vt=function(e){"string"==typeof e&&(e={apiKey:e});var t=[];e.sessionTrackingEnabled&&(t.push("deprecated option sessionTrackingEnabled is now called autoCaptureSessions"),e.autoCaptureSessions=e.sessionTrackingEnabled),!e.endpoint&&!e.sessionEndpoint||e.endpoints||(t.push("deprecated options endpoint/sessionEndpoint are now configured in the endpoints object"),e.endpoints={notify:e.endpoint,sessions:e.sessionEndpoint}),e.endpoints&&e.endpoints.notify&&!e.endpoints.sessions&&t.push("notify endpoint is set but sessions endpoint is not. No sessions will be sent.");var r,n=new de({name:"Bugsnag JavaScript",version:"6.1.0",url:"https://github.com/bugsnag/bugsnag-js"});return n.setOptions(e),n.delivery(window.XDomainRequest?be():(void 0===r&&(r=window),{sendReport:function(e,t,n,i){void 0===i&&(i=function(){});try{var o=t.endpoints.notify,s=new r.XMLHttpRequest;s.onreadystatechange=function(){s.readyState===r.XMLHttpRequest.DONE&&i(null)},s.open("POST",o),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Bugsnag-Api-Key",n.apiKey||t.apiKey),s.setRequestHeader("Bugsnag-Payload-Version","4"),s.setRequestHeader("Bugsnag-Sent-At",Ce()),s.send(ge.report(n,t.filters))}catch(t){e.error(t)}},sendSession:function(e,t,n,i){void 0===i&&(i=function(){});try{var o=t.endpoints.sessions,s=new r.XMLHttpRequest;s.onreadystatechange=function(){s.readyState===r.XMLHttpRequest.DONE&&i(null)},s.open("POST",o),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Bugsnag-Api-Key",t.apiKey),s.setRequestHeader("Bugsnag-Payload-Version","1"),s.setRequestHeader("Bugsnag-Sent-At",Ce()),s.send(ge.session(n,t.filters))}catch(t){e.error(t)}}})),n.configure(_t),St(t,function(e){return n._logger.warn(e)}),n.use(ke),n.use(Ee),n.use(Re),n.use(je),n.use(ct),n.use(Oe),n.use(Be),n.use(ut),!1!==n.config.autoNotify&&(n.use(lt),n.use(mt)),n.use(Ve),n.use(Ge),n.use(Ye),n.use(Me),n._logger.debug("Loaded!"),n.config.autoCaptureSessions?n.startSession():n}).Bugsnag={Client:de,Report:F,Session:ee,Breadcrumb:E},vt.default=vt,vt})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],30:[function(e,t,r){t.exports=e("@bugsnag/browser")},{"@bugsnag/browser":29}],31:[function(e,t,r){function noop(){}t.exports=function after(e,t,r){var n=!1;return r=r||noop,proxy.count=e,0===e?t():proxy;function proxy(e,i){if(proxy.count<=0)throw new Error("after called too many times");--proxy.count,e?(n=!0,t(e),t=r):0!==proxy.count||n||t(null,i)}}},{}],32:[function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(r-t),s=t,a=0;s<r;s++,a++)o[a]=i[s];return o.buffer}},{}],33:[function(e,t,r){function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=Backoff,Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e}},{}],34:[function(e,t,r){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=new Uint8Array(256),n=0;n<e.length;n++)t[e.charCodeAt(n)]=n;r.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},r.decode=function(e){var r,n,i,o,s,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),p=new Uint8Array(d);for(r=0;r<c;r+=4)n=t[e.charCodeAt(r)],i=t[e.charCodeAt(r+1)],o=t[e.charCodeAt(r+2)],s=t[e.charCodeAt(r+3)],p[u++]=n<<2|i>>4,p[u++]=(15&i)<<4|o>>2,p[u++]=(3&o)<<6|63&s;return d}}()},{}],35:[function(e,t,r){"use strict";r.byteLength=function byteLength(e){var t=getLens(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function toByteArray(e){for(var t,r=getLens(e),n=r[0],s=r[1],a=new o(function _byteLength(e,t,r){return 3*(t+r)/4-r}(0,n,s)),c=0,u=s>0?n-4:n,d=0;d<u;d+=4)t=i[e.charCodeAt(d)]<<18|i[e.charCodeAt(d+1)]<<12|i[e.charCodeAt(d+2)]<<6|i[e.charCodeAt(d+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;2===s&&(t=i[e.charCodeAt(d)]<<2|i[e.charCodeAt(d+1)]>>4,a[c++]=255&t);1===s&&(t=i[e.charCodeAt(d)]<<10|i[e.charCodeAt(d+1)]<<4|i[e.charCodeAt(d+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t);return a},r.fromByteArray=function fromByteArray(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(encodeChunk(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function getLens(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function encodeChunk(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],36:[function(e,t,r){var n=void 0!==n?n:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,i=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),o=i&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;function mapArrayBufferViews(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e})}function BlobBuilderConstructor(e,t){t=t||{};var r=new n;return mapArrayBufferViews(e).forEach(function(e){r.append(e)}),t.type?r.getBlob(t.type):r.getBlob()}function BlobConstructor(e,t){return new Blob(mapArrayBufferViews(e),t||{})}"undefined"!=typeof Blob&&(BlobBuilderConstructor.prototype=Blob.prototype,BlobConstructor.prototype=Blob.prototype),t.exports=i?o?Blob:BlobConstructor:s?BlobBuilderConstructor:void 0},{}],37:[function(e,t,r){},{}],38:[function(e,t,r){"use strict";var n=e("base64-js"),i=e("ieee754");r.Buffer=Buffer,r.SlowBuffer=function SlowBuffer(e){+e!=e&&(e=0);return Buffer.alloc(+e)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function createBuffer(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=Buffer.prototype,t}function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,r)}function from(e,t,r){if("string"==typeof e)return function fromString(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|byteLength(e,t),n=createBuffer(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return function fromArrayBuffer(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=Buffer.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var i=function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),r=createBuffer(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(void 0!==e.length)return"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e);if("Buffer"===e.type&&Array.isArray(e.data))return fromArrayLike(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function allocUnsafe(e){return assertSize(e),createBuffer(e<0?0:0|checked(e))}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),r=createBuffer(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function checked(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function byteLength(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||isInstance(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(i)return n?-1:utf8ToBytes(e).length;t=(""+t).toLowerCase(),i=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),numberIsNaN(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function read(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=r;o<a;o++)if(read(e,o)===read(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var d=!0,p=0;p<c;p++)if(read(e,o+p)!==read(t,p)){d=!1;break}if(d)return o}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(numberIsNaN(a))return s;e[r+s]=a}return s}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(function utf16leToBytes(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,c,u,d=e[i],p=null,l=d>239?4:d>223?3:d>191?2:1;if(i+l<=r)switch(l){case 1:d<128&&(p=d);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&d)<<6|63&o)>127&&(p=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&d)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(p=u);break;case 4:o=e[i+1],a=e[i+2],c=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&c)&&(u=(15&d)<<18|(63&o)<<12|(63&a)<<6|63&c)>65535&&u<1114112&&(p=u)}null===p?(p=65533,l=1):p>65535&&(p-=65536,n.push(p>>>10&1023|55296),p=56320|1023&p),n.push(p),i+=l}return function decodeCodePointsArray(e){var t=e.length;if(t<=s)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=s));return r}(n)}r.kMaxLength=o,Buffer.TYPED_ARRAY_SUPPORT=function typedArraySupport(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(e,t,r){return from(e,t,r)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(e,t,r){return function alloc(e,t,r){return assertSize(e),e<=0?createBuffer(e):void 0!==t?"string"==typeof r?createBuffer(e).fill(t,r):createBuffer(e).fill(t):createBuffer(e)}(e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(e)},Buffer.isBuffer=function isBuffer(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function compare(e,t){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function isEncoding(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(isInstance(o,Uint8Array)&&(o=Buffer.from(o)),!Buffer.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function swap32(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function swap64(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function toString(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function inspect(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},Buffer.prototype.compare=function compare(e,t,r,n,i){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,s=r-t,a=Math.min(o,s),c=this.slice(n,i),u=e.slice(t,r),d=0;d<a;++d)if(c[d]!==u[d]){o=c[d],s=u[d];break}return o<s?-1:s<o?1:0},Buffer.prototype.includes=function includes(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function indexOf(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function write(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var s=4096;function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=toHex(e[o]);return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,i,o){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function checkIEEE754(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,o){return t=+t,r>>>=0,o||checkIEEE754(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,o){return t=+t,r>>>=0,o||checkIEEE754(e,0,r,8),i.write(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function slice(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=Buffer.prototype,n},Buffer.prototype.readUIntLE=function readUIntLE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},Buffer.prototype.readUIntBE=function readUIntBE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer.prototype.readUInt8=function readUInt8(e,t){return e>>>=0,t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function readUInt16LE(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function readIntLE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function readIntBE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},Buffer.prototype.readInt8=function readInt8(e,t){return e>>>=0,t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function readInt16LE(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function readInt16BE(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function readInt32LE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function readFloatLE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),i.read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),i.read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(e,t){return e>>>=0,t||checkOffset(e,8,this.length),i.read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(e,t){return e>>>=0,t||checkOffset(e,8,this.length),i.read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},Buffer.prototype.writeUIntBE=function writeUIntBE(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},Buffer.prototype.writeUInt8=function writeUInt8(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function writeIntLE(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Buffer.prototype.writeIntBE=function writeIntBE(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Buffer.prototype.writeInt8=function writeInt8(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function writeInt16LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function writeInt16BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function writeInt32LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function writeInt32BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function writeFloatLE(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function writeFloatBE(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function copy(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;o>=0;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},Buffer.prototype.fill=function fill(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=Buffer.isBuffer(e)?e:Buffer.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var a=/[^+/0-9A-Za-z-_]/g;function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function base64ToBytes(e){return n.toByteArray(function base64clean(e){if((e=(e=e.split("=")[0]).trim().replace(a,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function blitBuffer(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}},{"base64-js":35,ieee754:49}],39:[function(e,t,r){var n=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},{}],40:[function(e,t,r){function Emitter(e){if(e)return function mixin(e){for(var t in Emitter.prototype)e[t]=Emitter.prototype[t];return e}(e)}void 0!==t&&(t.exports=Emitter),Emitter.prototype.on=Emitter.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Emitter.prototype.once=function(e,t){function on(){this.off(e,on),t.apply(this,arguments)}return on.fn=t,this.on(e,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},Emitter.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},Emitter.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Emitter.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],41:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],42:[function(e,t,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){return function BrowserInfo(e,t,r){this.name=e,this.version=t,this.os=r}}();r.BrowserInfo=t;var n=function(){return function NodeInfo(t){this.version=t,this.name="node",this.os=e.platform}}();r.NodeInfo=n;var i=function(){return function BotInfo(){this.bot=!0,this.name="bot",this.version=null,this.os=null}}();r.BotInfo=i;var o=3,s=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],a=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function parseUserAgent(e){var r=""!==e&&s.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var o=i.exec(e);return!!o&&[n,o]},!1);if(!r)return null;var n=r[0],a=r[1];if("searchbot"===n)return new i;var c=a[1]&&a[1].split(/[._]/).slice(0,3);return c?c.length<o&&(c=c.concat(function createVersionParts(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}(o-c.length))):c=[],new t(n,c.join("."),detectOS(e))}function detectOS(e){for(var t=0,r=a.length;t<r;t++){var n=a[t],i=n[0];if(n[1].test(e))return i}return null}function getNodeVersion(){return void 0!==e&&e.version?new n(e.version.slice(1)):null}r.detect=function detect(){return"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):getNodeVersion()},r.parseUserAgent=parseUserAgent,r.detectOS=detectOS,r.getNodeVersion=getNodeVersion}).call(this,e("_process"))},{_process:56}],43:[function(e,t,r){var n,i=e("./keys"),o=e("has-binary2"),s=e("arraybuffer.slice"),a=e("after"),c=e("./utf8");"undefined"!=typeof ArrayBuffer&&(n=e("base64-arraybuffer"));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),d="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),p=u||d;r.protocol=3;var l=r.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},h=i(l),f={type:"error",data:"parser error"},m=e("blob");function map(e,t,r){for(var n=new Array(e.length),i=a(e.length,r),o=function(e,r,i){t(r,function(t,r){n[e]=r,i(t,n)})},s=0;s<e.length;s++)o(s,e[s],i)}r.encodePacket=function(e,t,n,i){"function"==typeof t&&(i=t,t=!1),"function"==typeof n&&(i=n,n=null);var o=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&o instanceof ArrayBuffer)return function encodeArrayBuffer(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=l[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return n(s.buffer)}(e,t,i);if(void 0!==m&&o instanceof m)return function encodeBlob(e,t,n){if(!t)return r.encodeBase64Packet(e,n);if(p)return function encodeBlobAsArrayBuffer(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){r.encodePacket({type:e.type,data:i.result},t,!0,n)},i.readAsArrayBuffer(e.data)}(e,t,n);var i=new Uint8Array(1);i[0]=l[e.type];var o=new m([i.buffer,e.data]);return n(o)}(e,t,i);if(o&&o.base64)return function encodeBase64Object(e,t){var n="b"+r.packets[e.type]+e.data.data;return t(n)}(e,i);var s=l[e.type];return void 0!==e.data&&(s+=n?c.encode(String(e.data),{strict:!1}):String(e.data)),i(""+s)},r.encodeBase64Packet=function(e,t){var n,i="b"+r.packets[e.type];if(void 0!==m&&e.data instanceof m){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];t(i+e)},o.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];n=String.fromCharCode.apply(null,a)}return i+=btoa(n),t(i)},r.decodePacket=function(e,t,n){if(void 0===e)return f;if("string"==typeof e){if("b"===e.charAt(0))return r.decodeBase64Packet(e.substr(1),t);if(n&&!1===(e=function tryDecode(e){try{e=c.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return f;var i=e.charAt(0);return Number(i)==i&&h[i]?e.length>1?{type:h[i],data:e.substring(1)}:{type:h[i]}:f}i=new Uint8Array(e)[0];var o=s(e,1);return m&&"blob"===t&&(o=new m([o])),{type:h[i],data:o}},r.decodeBase64Packet=function(e,t){var r=h[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=n.decode(e.substr(1));return"blob"===t&&m&&(i=new m([i])),{type:r,data:i}},r.encodePayload=function(e,t,n){"function"==typeof t&&(n=t,t=null);var i=o(e);if(t&&i)return m&&!p?r.encodePayloadAsBlob(e,n):r.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");map(e,function encodeOne(e,n){r.encodePacket(e,!!i&&t,!1,function(e){n(null,function setLengthHeader(e){return e.length+":"+e}(e))})},function(e,t){return n(t.join(""))})},r.decodePayload=function(e,t,n){if("string"!=typeof e)return r.decodePayloadAsBinary(e,t,n);var i;if("function"==typeof t&&(n=t,t=null),""===e)return n(f,0,1);for(var o,s,a="",c=0,u=e.length;c<u;c++){var d=e.charAt(c);if(":"===d){if(""===a||a!=(o=Number(a)))return n(f,0,1);if(a!=(s=e.substr(c+1,o)).length)return n(f,0,1);if(s.length){if(i=r.decodePacket(s,t,!1),f.type===i.type&&f.data===i.data)return n(f,0,1);if(!1===n(i,c+o,u))return}c+=o,a=""}else a+=d}return""!==a?n(f,0,1):void 0},r.encodePayloadAsArrayBuffer=function(e,t){if(!e.length)return t(new ArrayBuffer(0));map(e,function encodeOne(e,t){r.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,r){var n=r.reduce(function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2},0),i=new Uint8Array(n),o=0;return r.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}i[o++]=t?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(n=new Uint8Array(r),s=0;s<n.length;s++)i[o++]=n[s]}),t(i.buffer)})},r.encodePayloadAsBlob=function(e,t){map(e,function encodeOne(e,t){r.encodePacket(e,!0,!0,function(e){var r=new Uint8Array(1);if(r[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,r[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,m){var a=new m([r.buffer,s.buffer,e]);t(null,a)}})},function(e,r){return t(new m(r))})},r.decodePayloadAsBinary=function(e,t,n){"function"==typeof t&&(n=t,t=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),c=0===a[0],u="",d=1;255!==a[d];d++){if(u.length>310)return n(f,0,1);u+=a[d]}i=s(i,2+u.length),u=parseInt(u);var p=s(i,0,u);if(c)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var l=new Uint8Array(p);p="";for(d=0;d<l.length;d++)p+=String.fromCharCode(l[d])}o.push(p),i=s(i,u)}var h=o.length;o.forEach(function(e,i){n(r.decodePacket(e,t,!0),i,h)})}},{"./keys":44,"./utf8":45,after:31,"arraybuffer.slice":32,"base64-arraybuffer":34,blob:36,"has-binary2":46}],44:[function(e,t,r){t.exports=Object.keys||function keys(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},{}],45:[function(e,t,r){var n,i,o,s=String.fromCharCode;function ucs2decode(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function checkScalarValue(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function createByte(e,t){return s(e>>t&63|128)}function encodeCodePoint(e,t){if(0==(4294967168&e))return s(e);var r="";return 0==(4294965248&e)?r=s(e>>6&31|192):0==(4294901760&e)?(checkScalarValue(e,t)||(e=65533),r=s(e>>12&15|224),r+=createByte(e,6)):0==(4292870144&e)&&(r=s(e>>18&7|240),r+=createByte(e,12),r+=createByte(e,6)),r+=s(63&e|128)}function readContinuationByte(){if(o>=i)throw Error("Invalid byte index");var e=255&n[o];if(o++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function decodeSymbol(e){var t,r;if(o>i)throw Error("Invalid byte index");if(o==i)return!1;if(t=255&n[o],o++,0==(128&t))return t;if(192==(224&t)){if((r=(31&t)<<6|readContinuationByte())>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&t)){if((r=(15&t)<<12|readContinuationByte()<<6|readContinuationByte())>=2048)return checkScalarValue(r,e)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(r=(7&t)<<18|readContinuationByte()<<12|readContinuationByte()<<6|readContinuationByte())>=65536&&r<=1114111)return r;throw Error("Invalid UTF-8 detected")}t.exports={version:"2.1.2",encode:function utf8encode(e,t){for(var r=!1!==(t=t||{}).strict,n=ucs2decode(e),i=n.length,o=-1,s="";++o<i;)s+=encodeCodePoint(n[o],r);return s},decode:function utf8decode(e,t){var r=!1!==(t=t||{}).strict;n=ucs2decode(e),i=n.length,o=0;for(var a,c=[];!1!==(a=decodeSymbol(r));)c.push(a);return function ucs2encode(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=s((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=s(t);return i}(c)}}},{}],46:[function(e,t,r){(function(r){var n=e("isarray"),i=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function hasBinary(e){if(!e||"object"!=typeof e)return!1;if(n(e)){for(var t=0,i=e.length;t<i;t++)if(hasBinary(e[t]))return!0;return!1}if("function"==typeof r&&r.isBuffer&&r.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||o&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return hasBinary(e.toJSON(),!0);for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&hasBinary(e[a]))return!0;return!1}}).call(this,e("buffer").Buffer)},{buffer:38,isarray:47}],47:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],48:[function(e,t,r){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},{}],49:[function(e,t,r){r.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,d=-7,p=r?i-1:0,l=r?-1:1,h=e[t+p];for(p+=l,o=h&(1<<-d)-1,h>>=-d,d+=a;d>0;o=256*o+e[t+p],p+=l,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=n;d>0;s=256*s+e[t+p],p+=l,d-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),o-=u}return(h?-1:1)*s*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,d=(1<<u)-1,p=d>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+p>=1?l/c:l*Math.pow(2,1-p))*c>=2&&(s++,c/=2),s+p>=d?(a=0,s=d):s+p>=1?(a=(t*c-1)*Math.pow(2,i),s+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,i),s=0));i>=8;e[r+h]=255&a,h+=f,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+h]=255&s,h+=f,s/=256,u-=8);e[r+h-f]|=128*m}},{}],50:[function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},{}],51:[function(e,t,r){var n,i;n=this,i=function(e){"use strict";var t,r,n={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},i={},o={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:function(e,r){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var o=e.methodFactory,s=e.name||"",a=i[s]||i[""]||n;return i[s]||(e.methodFactory=function methodFactory(e,t,r){var n=o(e,t,r),a=i[r]||i[""],c=-1!==a.template.indexOf("%t"),u=-1!==a.template.indexOf("%l"),d=-1!==a.template.indexOf("%n");return function(){for(var t="",o=arguments.length,p=Array(o),l=0;l<o;l++)p[l]=arguments[l];if(s||!i[r]){var h=a.timestampFormatter(new Date),f=a.levelFormatter(e),m=a.nameFormatter(r);a.format?t+=a.format(f,m,h):(t+=a.template,c&&(t=t.replace(/%t/,h)),u&&(t=t.replace(/%l/,f)),d&&(t=t.replace(/%n/,m))),p.length&&"string"==typeof p[0]?p[0]=t+" "+p[0]:p.unshift(t)}n.apply(void 0,p)}}),(r=r||{}).template&&(r.format=void 0),i[s]=function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(t in arguments[r])Object.prototype.hasOwnProperty.call(arguments[r],t)&&(e[t]=arguments[r][t]);return e}({},a,r),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e}};return e&&(r=e.prefix,o.noConflict=function(){return e.prefix===o&&(e.prefix=r),o}),o},"function"==typeof define&&define.amd?define(i):"object"==typeof t&&t.exports?t.exports=i():n.prefix=i(n)},{}],52:[function(e,t,r){!function(e,r){"use strict";"function"==typeof define&&define.amd?define(r):"object"==typeof t&&t.exports?t.exports=r():e.log=r()}(this,function(){"use strict";var e=function(){},t="undefined",r=["trace","debug","info","warn","error"];function bindMethod(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function replaceLoggingMethods(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function defaultMethodFactory(r,n,i){return function realMethod(r){return"debug"===r&&(r="log"),typeof console!==t&&(void 0!==console[r]?bindMethod(console,r):void 0!==console.log?bindMethod(console,"log"):e)}(r)||function enableLoggingWhenConsoleArrives(e,r,n){return function(){typeof console!==t&&(replaceLoggingMethods.call(this,r,n),this[e].apply(this,arguments))}}.apply(this,arguments)}function Logger(e,n,i){var o,s=this,a="loglevel";function getPersistedLevel(){var e;if(typeof window!==t){try{e=window.localStorage[a]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(a)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}e&&(a+=":"+e),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=i||defaultMethodFactory,s.getLevel=function(){return o},s.setLevel=function(n,i){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==i&&function persistLevelIfPossible(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[a]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+n+";"}catch(e){}}}(n),replaceLoggingMethods.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){getPersistedLevel()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var c=getPersistedLevel();null==c&&(c=null==n?"WARN":n),s.setLevel(c,!1)}var n=new Logger,i={};n.getLogger=function getLogger(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new Logger(e,n.getLevel(),n.methodFactory)),t};var o=typeof window!==t?window.log:void 0;return n.noConflict=function(){return typeof window!==t&&window.log===n&&(window.log=o),n},n.getLoggers=function getLoggers(){return i},n})},{}],53:[function(e,t,r){var n=1e3,i=60*n,o=60*i,s=24*o,a=365.25*s;function plural(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function parse(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*a;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?function fmtLong(e){return plural(e,s,"day")||plural(e,o,"hour")||plural(e,i,"minute")||plural(e,n,"second")||e+" ms"}(e):function fmtShort(e){if(e>=s)return Math.round(e/s)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],54:[function(e,t,r){r.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},r.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},{}],55:[function(e,t,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function parseuri(e){var t=e,r=e.indexOf("["),o=e.indexOf("]");-1!=r&&-1!=o&&(e=e.substring(0,r)+e.substring(r,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[i[c]]=s[c]||"";return-1!=r&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},{}],56:[function(e,t,r){var n,i,o=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)return setTimeout(e,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{i="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){i=defaultClearTimeout}}();var s,a=[],c=!1,u=-1;function cleanUpNextTick(){c&&s&&(c=!1,s.length?a=s.concat(a):u=-1,a.length&&drainQueue())}function drainQueue(){if(!c){var e=runTimeout(cleanUpNextTick);c=!0;for(var t=a.length;t;){for(s=a,a=[];++u<t;)s&&s[u].run();u=-1,t=a.length}s=null,c=!1,function runClearTimeout(e){if(i===clearTimeout)return clearTimeout(e);if((i===defaultClearTimeout||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new Item(e,t)),1!==a.length||c||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.prependListener=noop,o.prependOnceListener=noop,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],57:[function(e,t,r){"use strict";var n=e("sdp");function writeMediaSection(e,t,r,i,o){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s}function getCommonCapabilities(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),s=n(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!i(n,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function isActionAllowedInSignalingState(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function maybeAddCandidate(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function makeError(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function addTrackToStreamAndFireEvent(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function fireAddTrack(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var r=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function filterIceServers(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},r.prototype.addTrack=function(t,r){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw makeError("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},r.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},r.prototype.removeTrack=function(t){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw makeError("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},r.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},r.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var u=n.writeCandidate(a);s.candidate=Object.assign(s.candidate,n.parseCandidate(u)),s.candidate.candidate=u,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var d=n.getMediaSections(i._localDescription.sdp);d[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+d.join("");var p=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),p&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){o.onlocalcandidate(e)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,r,i){var o=getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},r.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+e.type+'"'));if(!isActionAllowedInSignalingState("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var o=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var s=i.transceivers[t],a=s.iceGatherer,c=s.iceTransport,u=s.dtlsTransport,d=s.localCapabilities,p=s.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!s.rejected){var l=n.getIceParameters(e,r),h=n.getDtlsParameters(e,r);o&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===c.state&&c.start(a,l,o?"controlling":"controlled"),"new"===u.state&&u.start(h));var f=getCommonCapabilities(d,p);i._transceive(s,f.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(r){var i=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+r.type+'"'));if(!isActionAllowedInSignalingState("setRemoteDescription",r.type,i.signalingState)||i._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set remote "+r.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var s=[],a=n.splitSections(r.sdp),c=a.shift(),u=n.matchPrefix(c,"a=ice-lite").length>0,d=n.matchPrefix(c,"a=group:BUNDLE ").length>0;i.usingBundle=d;var p=n.matchPrefix(c,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,a.forEach(function(a,p){var l=n.splitLines(a),h=n.getKind(a),f=n.isRejected(a)&&0===n.matchPrefix(a,"a=bundle-only").length,m=l[0].substr(2).split(" ")[2],g=n.getDirection(a,c),v=n.parseMsid(a),y=n.getMid(a)||n.generateIdentifier();if(f||"application"===h&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))i.transceivers[p]={mid:y,kind:h,protocol:m,rejected:!0};else{var b,S,_,w,C,E,T,k,R;!f&&i.transceivers[p]&&i.transceivers[p].rejected&&(i.transceivers[p]=i._createTransceiver(h,!0));var P,x,O=n.parseRtpParameters(a);f||(P=n.getIceParameters(a,c),(x=n.getDtlsParameters(a,c)).role="client"),T=n.parseRtpEncodingParameters(a);var A=n.parseRtcpParameters(a),B=n.matchPrefix(a,"a=end-of-candidates",c).length>0,M=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!f&&d&&p>0&&i.transceivers[p]&&(i._disposeIceAndDtlsTransports(p),i.transceivers[p].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[p].iceTransport=i.transceivers[0].iceTransport,i.transceivers[p].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[p].rtpSender&&i.transceivers[p].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[p].rtpReceiver&&i.transceivers[p].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==r.type||f){if("answer"===r.type&&!f){S=(b=i.transceivers[p]).iceGatherer,_=b.iceTransport,w=b.dtlsTransport,C=b.rtpReceiver,E=b.sendEncodingParameters,k=b.localCapabilities,i.transceivers[p].recvEncodingParameters=T,i.transceivers[p].remoteCapabilities=O,i.transceivers[p].rtcpParameters=A,M.length&&"new"===_.state&&(!u&&!B||d&&0!==p?M.forEach(function(e){maybeAddCandidate(b.iceTransport,e)}):_.setRemoteCandidates(M)),d&&0!==p||("new"===_.state&&_.start(S,P,"controlling"),"new"===w.state&&w.start(x)),!getCommonCapabilities(b.localCapabilities,b.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,i._transceive(b,"sendrecv"===g||"recvonly"===g,"sendrecv"===g||"sendonly"===g),!C||"sendrecv"!==g&&"sendonly"!==g?delete b.rtpReceiver:(R=C.track,v?(o[v.stream]||(o[v.stream]=new e.MediaStream),addTrackToStreamAndFireEvent(R,o[v.stream]),s.push([R,C,o[v.stream]])):(o.default||(o.default=new e.MediaStream),addTrackToStreamAndFireEvent(R,o.default),s.push([R,C,o.default])))}}else{(b=i.transceivers[p]||i._createTransceiver(h)).mid=y,b.iceGatherer||(b.iceGatherer=i._createIceGatherer(p,d)),M.length&&"new"===b.iceTransport.state&&(!B||d&&0!==p?M.forEach(function(e){maybeAddCandidate(b.iceTransport,e)}):b.iceTransport.setRemoteCandidates(M)),k=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(k.codecs=k.codecs.filter(function(e){return"rtx"!==e.name})),E=b.sendEncodingParameters||[{ssrc:1001*(2*p+2)}];var I,D=!1;if("sendrecv"===g||"sendonly"===g){if(D=!b.rtpReceiver,C=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,h),D)R=C.track,v&&"-"===v.stream||(v?(o[v.stream]||(o[v.stream]=new e.MediaStream,Object.defineProperty(o[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(R,"id",{get:function(){return v.track}}),I=o[v.stream]):(o.default||(o.default=new e.MediaStream),I=o.default)),I&&(addTrackToStreamAndFireEvent(R,I),b.associatedRemoteMediaStreams.push(I)),s.push([R,C,I])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===b.rtpReceiver.track.id});r&&function removeTrackFromStreamAndFireEvent(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),b.associatedRemoteMediaStreams=[]);b.localCapabilities=k,b.remoteCapabilities=O,b.rtpReceiver=C,b.rtcpParameters=A,b.sendEncodingParameters=E,b.recvEncodingParameters=T,i._transceive(i.transceivers[p],!1,D)}}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===r.type?"active":"passive"),i._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(-1===i.remoteStreams.indexOf(r)){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i._dispatchEvent("addstream",n)})}s.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&fireAddTrack(i,t,n,[r])})}}),s.forEach(function(e){e[2]||fireAddTrack(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},r.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},r.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},r.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(i=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});i>0||o>0;)i>0&&(r._createTransceiver("audio"),i--),o>0&&(r._createTransceiver("video"),o--);var a=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var s=i.track,a=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=u,i.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){a+=writeMediaSection(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,a+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:a});return Promise.resolve(c)},r.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var i=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(i+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n";var o=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var s;if(e.stream)"audio"===e.kind?s=e.stream.getAudioTracks()[0]:"video"===e.kind&&(s=e.stream.getVideoTracks()[0]),s&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var a=getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);!a.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=writeMediaSection(e,a,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(s)},r.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(makeError("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<r.transceivers.length;a++)if(r.transceivers[a].mid===e.sdpMid){s=a;break}var c=r.transceivers[s];if(!c)return o(makeError("OperationError","Can not add ICE candidate"));if(c.rejected)return i();var u=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===s||s>0&&c.iceTransport!==r.transceivers[0].iceTransport)&&!maybeAddCandidate(c.iceTransport,u))return o(makeError("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[s]+="a="+(u.type?d:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);i()})},r.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw makeError("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=function fixStatsType(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[r]),t.set(r,e[r])}),t})}}});var i=["createOffer","createAnswer"];return i.forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(i=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),r}},{sdp:58}],58:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],s=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=n.parseRtpMap(s),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?n.parseFmtp(c[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,r=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=n.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var s=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,o=void 0!==t?t:2;return i=e||n.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}],59:[function(e,t,r){var n=e("./url"),i=e("socket.io-parser"),o=e("./manager"),s=e("debug")("socket.io-client");t.exports=r=lookup;var a=r.managers={};function lookup(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i=n(e),c=i.source,u=i.id,d=i.path,p=a[u]&&d in a[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(s("ignoring socket cache for %s",c),r=o(c,t)):(a[u]||(s("new io instance for %s",c),a[u]=o(c,t)),r=a[u]),i.query&&!t.query&&(t.query=i.query),r.socket(i.path,t)}r.protocol=i.protocol,r.connect=lookup,r.Manager=e("./manager"),r.Socket=e("./socket")},{"./manager":60,"./socket":62,"./url":63,debug:64,"socket.io-parser":77}],60:[function(e,t,r){var n=e("engine.io-client"),i=e("./socket"),o=e("component-emitter"),s=e("socket.io-parser"),a=e("./on"),c=e("component-bind"),u=e("debug")("socket.io-client:manager"),d=e("indexof"),p=e("backo2"),l=Object.prototype.hasOwnProperty;function Manager(e,t){if(!(this instanceof Manager))return new Manager(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}t.exports=Manager,Manager.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)l.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},Manager.prototype.updateSocketIds=function(){for(var e in this.nsps)l.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},Manager.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},o(Manager.prototype),Manager.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},Manager.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},Manager.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},Manager.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},Manager.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},Manager.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},Manager.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Manager.prototype.open=Manager.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(r,"open",function(){i.onopen(),e&&e()}),s=a(r,"error",function(t){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var d=setTimeout(function(){u("connect attempt timed out after %d",c),o.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(o),this.subs.push(s),this},Manager.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},Manager.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Manager.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Manager.prototype.ondata=function(e){this.decoder.add(e)},Manager.prototype.ondecoded=function(e){this.emit("packet",e)},Manager.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},Manager.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new i(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",onConnecting),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&onConnecting()}function onConnecting(){~d(n.connecting,r)||n.connecting.push(r)}return r},Manager.prototype.destroy=function(e){var t=d(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},Manager.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},Manager.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Manager.prototype.close=Manager.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Manager.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},Manager.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":61,"./socket":62,backo2:33,"component-bind":39,"component-emitter":40,debug:64,"engine.io-client":66,indexof:50,"socket.io-parser":77}],61:[function(e,t,r){t.exports=function on(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}},{}],62:[function(e,t,r){var n=e("socket.io-parser"),i=e("component-emitter"),o=e("to-array"),s=e("./on"),a=e("component-bind"),c=e("debug")("socket.io-client:socket"),u=e("parseqs"),d=e("has-binary2");t.exports=Socket;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=i.prototype.emit;function Socket(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(Socket.prototype),Socket.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},Socket.prototype.open=Socket.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},Socket.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},Socket.prototype.emit=function(e){if(p.hasOwnProperty(e))return l.apply(this,arguments),this;var t=o(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:d(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},Socket.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},Socket.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},Socket.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},Socket.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===n.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},Socket.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},Socket.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=o(arguments);c("sending ack %j",i),t.packet({type:d(i)?n.BINARY_ACK:n.ACK,id:e,data:i})}}},Socket.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},Socket.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},Socket.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},Socket.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},Socket.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},Socket.prototype.close=Socket.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},Socket.prototype.compress=function(e){return this.flags.compress=e,this},Socket.prototype.binary=function(e){return this.flags.binary=e,this}},{"./on":61,"component-bind":39,"component-emitter":40,debug:64,"has-binary2":46,parseqs:54,"socket.io-parser":77,"to-array":79}],63:[function(e,t,r){var n=e("parseuri"),i=e("debug")("socket.io-client:url");t.exports=function url(e,t){var r=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),r=n(e));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}},{debug:64,parseuri:55}],64:[function(e,t,r){(function(n){function load(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(r=t.exports=e("./debug")).log=function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function formatArgs(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,n)},r.save=function save(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=load,r.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function localstorage(){try{return window.localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(load())}).call(this,e("_process"))},{"./debug":65,_process:56}],65:[function(e,t,r){function createDebug(e){var t;function debug(){if(debug.enabled){var e=debug,n=+new Date,i=n-(t||n);e.diff=i,e.prev=t,e.curr=n,t=n;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=r.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;a++;var i=r.formatters[n];if("function"==typeof i){var s=o[a];t=i.call(e,s),o.splice(a,1),a--}return t}),r.formatArgs.call(e,o),(debug.log||r.log||console.log.bind(console)).apply(e,o)}}return debug.namespace=e,debug.enabled=r.enabled(e),debug.useColors=r.useColors(),debug.color=function selectColor(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}(e),debug.destroy=destroy,"function"==typeof r.init&&r.init(debug),r.instances.push(debug),debug}function destroy(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}(r=t.exports=createDebug.debug=createDebug.default=createDebug).coerce=function coerce(e){return e instanceof Error?e.stack||e.message:e},r.disable=function disable(){r.enable("")},r.enable=function enable(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function enabled(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.instances=[],r.names=[],r.skips=[],r.formatters={}},{ms:53}],66:[function(e,t,r){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":67,"engine.io-parser":43}],67:[function(e,t,r){var n=e("./transports/index"),i=e("component-emitter"),o=e("debug")("engine.io-client:socket"),s=e("indexof"),a=e("engine.io-parser"),c=e("parseuri"),u=e("parseqs");function Socket(e,t){if(!(this instanceof Socket))return new Socket(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=c(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=c(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=Socket,Socket.priorWebsocketSuccess=!1,i(Socket.prototype),Socket.protocol=a.protocol,Socket.Socket=Socket,Socket.Transport=e("./transport"),Socket.transports=e("./transports/index"),Socket.parser=e("engine.io-parser"),Socket.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=function clone(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new n[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},Socket.prototype.open=function(){var e;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Socket.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},Socket.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function onTransportOpen(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;Socket.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(o("changing transport and sending upgrade packet"),cleanup(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())})}else{o('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,n.emit("upgradeError",s)}}))}function freezeTransport(){r||(r=!0,cleanup(),t.close(),t=null)}function onerror(r){var i=new Error("probe error: "+r);i.transport=t.name,freezeTransport(),o('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),freezeTransport())}function cleanup(){t.removeListener("open",onTransportOpen),t.removeListener("error",onerror),t.removeListener("close",onTransportClose),n.removeListener("close",onclose),n.removeListener("upgrading",onupgrade)}Socket.priorWebsocketSuccess=!1,t.once("open",onTransportOpen),t.once("error",onerror),t.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),t.open()},Socket.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Socket.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Socket.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Socket.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},Socket.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},Socket.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()}function close(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function cleanupAndClose(){e.removeListener("upgrade",cleanupAndClose),e.removeListener("upgradeError",cleanupAndClose),close()}function waitForUpgrade(){e.once("upgrade",cleanupAndClose),e.once("upgradeError",cleanupAndClose)}return this},Socket.prototype.onError=function(e){o("socket error %j",e),Socket.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Socket.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},Socket.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~s(this.transports,e[r])&&t.push(e[r]);return t}},{"./transport":68,"./transports/index":69,"component-emitter":40,debug:64,"engine.io-parser":43,indexof:50,parseqs:54,parseuri:55}],68:[function(e,t,r){var n=e("engine.io-parser"),i=e("component-emitter");function Transport(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}t.exports=Transport,i(Transport.prototype),Transport.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},Transport.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Transport.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Transport.prototype.onPacket=function(e){this.emit("packet",e)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":40,"engine.io-parser":43}],69:[function(e,t,r){var n=e("xmlhttprequest-ssl"),i=e("./polling-xhr"),o=e("./polling-jsonp"),s=e("./websocket");r.polling=function polling(e){var t=!1,r=!1,s=!1!==e.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,r=e.secure!==a}if(e.xdomain=t,e.xscheme=r,"open"in new n(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new o(e)},r.websocket=s},{"./polling-jsonp":70,"./polling-xhr":71,"./websocket":73,"xmlhttprequest-ssl":74}],70:[function(e,t,r){(function(r){var n=e("./polling"),i=e("component-inherit");t.exports=JSONPPolling;var o,s=/\n/g,a=/\\n/g;function empty(){}function glob(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:{}}function JSONPPolling(e){if(n.call(this,e),this.query=this.query||{},!o){var t=glob();o=t.___eio=t.___eio||[]}this.index=o.length;var r=this;o.push(function(e){r.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){r.script&&(r.script.onerror=empty)},!1)}i(JSONPPolling,n),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},JSONPPolling.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function complete(){initIframe(),t()}function initIframe(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),initIframe(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&complete()}:this.iframe.onload=complete}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":72,"component-inherit":41}],71:[function(e,t,r){var n=e("xmlhttprequest-ssl"),i=e("./polling"),o=e("component-emitter"),s=e("component-inherit"),a=e("debug")("engine.io-client:polling-xhr");function empty(){}function XHR(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}function Request(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(t.exports=XHR,t.exports.Request=Request,s(XHR,i),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new Request(e)},XHR.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=n},XHR.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o(Request.prototype),Request.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e),r=this;try{a("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},a("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},Request.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},Request.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=empty:this.xhr.onreadystatechange=empty,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},Request.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},Request.prototype.abort=function(){this.cleanup()},Request.requestsCount=0,Request.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){var c="onpagehide"in self?"pagehide":"unload";addEventListener(c,unloadHandler,!1)}function unloadHandler(){for(var e in Request.requests)Request.requests.hasOwnProperty(e)&&Request.requests[e].abort()}},{"./polling":72,"component-emitter":40,"component-inherit":41,debug:64,"xmlhttprequest-ssl":74}],72:[function(e,t,r){var n=e("../transport"),i=e("parseqs"),o=e("engine.io-parser"),s=e("component-inherit"),a=e("yeast"),c=e("debug")("engine.io-client:polling");t.exports=Polling;var u=null!=new(e("xmlhttprequest-ssl"))({xdomain:!1}).responseType;function Polling(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),n.call(this,e)}s(Polling,n),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(e){var t=this;function pause(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||pause()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||pause()}))}else pause()},Polling.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(e){var t=this;c("polling got data %s",e);o.decodePayload(e,this.socket.binaryType,function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){var e=this;function close(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),close()):(c("transport not open - deferring close"),this.once("open",close))},Polling.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},Polling.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},{"../transport":68,"component-inherit":41,debug:64,"engine.io-parser":43,parseqs:54,"xmlhttprequest-ssl":74,yeast:101}],73:[function(e,t,r){(function(r){var n,i,o=e("../transport"),s=e("engine.io-parser"),a=e("parseqs"),c=e("component-inherit"),u=e("yeast"),d=e("debug")("engine.io-client:websocket");if("undefined"==typeof self)try{i=e("ws")}catch(e){}else n=self.WebSocket||self.MozWebSocket;var p=n||i;function WS(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=n&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(p=i),o.call(this,e)}t.exports=WS,c(WS,o),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new p(e,t):new p(e):new p(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},WS.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},WS.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,i=0,o=n;i<o;i++)!function(e){s.encodePacket(e,t.supportsBinary,function(i){if(!t.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),t.perMessageDeflate)("string"==typeof i?r.byteLength(i):i.length)<t.perMessageDeflate.threshold&&(o.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(i):t.ws.send(i,o)}catch(e){d("websocket closed before onclose event")}--n||done()})}(e[i]);function done(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},WS.prototype.onClose=function(){o.prototype.onClose.call(this)},WS.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},WS.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},WS.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===WS.prototype.name)}}).call(this,e("buffer").Buffer)},{"../transport":68,buffer:38,"component-inherit":41,debug:64,"engine.io-parser":43,parseqs:54,ws:37,yeast:101}],74:[function(e,t,r){var n=e("has-cors");t.exports=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":48}],75:[function(e,t,r){arguments[4][47][0].apply(r,arguments)},{dup:47}],76:[function(e,t,r){var n=e("isarray"),i=e("./is-buffer"),o=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);r.deconstructPacket=function(e){var t=[],r=e.data,o=e;return o.data=function _deconstructPacket(e,t){if(!e)return e;if(i(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(n(e)){for(var o=new Array(e.length),s=0;s<e.length;s++)o[s]=_deconstructPacket(e[s],t);return o}if("object"==typeof e&&!(e instanceof Date)){var o={};for(var a in e)o[a]=_deconstructPacket(e[a],t);return o}return e}(r,t),o.attachments=t.length,{packet:o,buffers:t}},r.reconstructPacket=function(e,t){return e.data=function _reconstructPacket(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(n(e))for(var r=0;r<e.length;r++)e[r]=_reconstructPacket(e[r],t);else if("object"==typeof e)for(var i in e)e[i]=_reconstructPacket(e[i],t);return e}(e.data,t),e.attachments=void 0,e},r.removeBlobs=function(e,t){var r=0,o=e;!function _removeBlobs(e,c,u){if(!e)return e;if(s&&e instanceof Blob||a&&e instanceof File){r++;var d=new FileReader;d.onload=function(){u?u[c]=this.result:o=this.result,--r||t(o)},d.readAsArrayBuffer(e)}else if(n(e))for(var p=0;p<e.length;p++)_removeBlobs(e[p],p,e);else if("object"==typeof e&&!i(e))for(var l in e)_removeBlobs(e[l],l,e)}(o),r||t(o)}},{"./is-buffer":78,isarray:75}],77:[function(e,t,r){var n=e("debug")("socket.io-parser"),i=e("component-emitter"),o=e("./binary"),s=e("isarray"),a=e("./is-buffer");function Encoder(){}r.protocol=4,r.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],r.CONNECT=0,r.DISCONNECT=1,r.EVENT=2,r.ACK=3,r.ERROR=4,r.BINARY_EVENT=5,r.BINARY_ACK=6,r.Encoder=Encoder,r.Decoder=Decoder;var c=r.ERROR+'"encode error"';function encodeAsString(e){var t=""+e.type;if(r.BINARY_EVENT!==e.type&&r.BINARY_ACK!==e.type||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data){var i=function tryStringify(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return c;t+=i}return n("encoded %j as %s",e,t),t}function Decoder(){this.reconstructor=null}function BinaryReconstructor(e){this.reconPack=e,this.buffers=[]}function error(e){return{type:r.ERROR,data:"parser error: "+e}}Encoder.prototype.encode=function(e,t){(n("encoding packet %j",e),r.BINARY_EVENT===e.type||r.BINARY_ACK===e.type)?function encodeAsBinary(e,t){o.removeBlobs(e,function writeEncoding(e){var r=o.deconstructPacket(e),n=encodeAsString(r.packet),i=r.buffers;i.unshift(n),t(i)})}(e,t):t([encodeAsString(e)])},i(Decoder.prototype),Decoder.prototype.add=function(e){var t;if("string"==typeof e)t=function decodeString(e){var t=0,i={type:Number(e.charAt(0))};if(null==r.types[i.type])return error("unknown packet type "+i.type);if(r.BINARY_EVENT===i.type||r.BINARY_ACK===i.type){for(var o="";"-"!==e.charAt(++t)&&(o+=e.charAt(t),t!=e.length););if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(t+1))for(i.nsp="";++t;){var a=e.charAt(t);if(","===a)break;if(i.nsp+=a,t===e.length)break}else i.nsp="/";var c=e.charAt(t+1);if(""!==c&&Number(c)==c){for(i.id="";++t;){var a=e.charAt(t);if(null==a||Number(a)!=a){--t;break}if(i.id+=e.charAt(t),t===e.length)break}i.id=Number(i.id)}if(e.charAt(++t)){var u=function tryParse(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t)),d=!1!==u&&(i.type===r.ERROR||s(u));if(!d)return error("invalid payload");i.data=u}return n("decoded %s as %j",e,i),i}(e),r.BINARY_EVENT===t.type||r.BINARY_ACK===t.type?(this.reconstructor=new BinaryReconstructor(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},Decoder.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},BinaryReconstructor.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":76,"./is-buffer":78,"component-emitter":40,debug:64,isarray:75}],78:[function(e,t,r){(function(e){t.exports=function isBuf(t){return r&&e.isBuffer(t)||n&&(t instanceof ArrayBuffer||i(t))};var r="function"==typeof e&&"function"==typeof e.isBuffer,n="function"==typeof ArrayBuffer,i=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}}).call(this,e("buffer").Buffer)},{buffer:38}],79:[function(e,t,r){t.exports=function toArray(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}},{}],80:[function(e,t,r){var n=e("./v1"),i=e("./v4"),o=i;o.v1=n,o.v4=i,t.exports=o},{"./v1":83,"./v4":84}],81:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function bytesToUuid(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},{}],82:[function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function whatwgRNG(){return n(i),i}}else{var o=new Array(16);t.exports=function mathRNG(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],83:[function(e,t,r){var n,i,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,c=0;t.exports=function v1(e,t,r){var u=t&&r||0,d=t||[],p=(e=e||{}).node||n,l=void 0!==e.clockseq?e.clockseq:i;if(null==p||null==l){var h=o();null==p&&(p=n=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==l&&(l=i=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:c+1,g=f-a+(m-c)/1e4;if(g<0&&void 0===e.clockseq&&(l=l+1&16383),(g<0||f>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=m,i=l;var v=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;d[u++]=v>>>24&255,d[u++]=v>>>16&255,d[u++]=v>>>8&255,d[u++]=255&v;var y=f/4294967296*1e4&268435455;d[u++]=y>>>8&255,d[u++]=255&y,d[u++]=y>>>24&15|16,d[u++]=y>>>16&255,d[u++]=l>>>8|128,d[u++]=255&l;for(var b=0;b<6;++b)d[u+b]=p[b];return t||s(d)}},{"./lib/bytesToUuid":81,"./lib/rng":82}],84:[function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function v4(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},{"./lib/bytesToUuid":81,"./lib/rng":82}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(0,e("./adapter_factory.js").adapterFactory)({window:window});r.default=n},{"./adapter_factory.js":86}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function adapterFactory(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,u=n.detectBrowser(e),d={browserDetails:u,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),d;r("adapter.js shimming chrome."),d.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=s,s.shimGetUserMedia(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),s.shimAddTransceiver(e),s.shimCreateOffer(e),s.shimCreateAnswer(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!o||!o.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),d;r("adapter.js shimming edge."),d.browserShim=o,o.shimGetUserMedia(e),o.shimGetDisplayMedia(e),o.shimPeerConnection(e),o.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return d};var n=_interopRequireWildcard(e("./utils")),i=_interopRequireWildcard(e("./chrome/chrome_shim")),o=_interopRequireWildcard(e("./edge/edge_shim")),s=_interopRequireWildcard(e("./firefox/firefox_shim")),a=_interopRequireWildcard(e("./safari/safari_shim")),c=_interopRequireWildcard(e("./common_shim"));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":87,"./common_shim":90,"./edge/edge_shim":91,"./firefox/firefox_shim":95,"./safari/safari_shim":98,"./utils":99}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function get(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function get(){return o.shimGetDisplayMedia}}),r.shimMediaStream=function shimMediaStream(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function shimOnTrack(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)s.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function get(){return this._ontrack},set:function set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function shimGetSendersWithDtmf(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function shimSenderWithDtmf(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function getSenders(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function addTrack(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function removeTrack(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function addStream(e){var r=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function removeStream(e){var t=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function getSenders(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function shimGetStats(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function getStats(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var s=function fixChromeStats_(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function makeMapStats(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return t.apply(this,[function successCallbackWrapper_(e){i(a(s(e)))},n])}return new Promise(function(r,n){t.apply(e,[function(e){r(a(s(e)))},n])}).then(i,o)}},r.shimSenderReceiverGetStats=function shimSenderReceiverGetStats(e){if(!("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function getSenders(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function addTrack(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function getStats(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function getReceivers(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function getStats(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!1)})}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function getStats(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}},r.shimAddTrackRemoveTrackWithNative=shimAddTrackRemoveTrackWithNative,r.shimAddTrackRemoveTrack=function shimAddTrackRemoveTrack(e){if(!e.RTCPeerConnection)return;var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function addStream(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;function replaceInternalStreamId(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function removeStream(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function addTrack(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var s=this._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty({},t,function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=replaceInternalStreamId(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return replaceInternalStreamId(e,t)})});e.RTCPeerConnection.prototype[t]=n[t]});var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function setLocalDescription(){return arguments.length&&arguments[0].type?(arguments[0]=function replaceExternalStreamId(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function get(){var e=a.get.apply(this);return""===e.type?e:replaceInternalStreamId(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function removeTrack(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r=e._pc===this;if(!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(r){var i=t._streams[r].getTracks().find(function(t){return e.track===t});i&&(n=t._streams[r])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}},r.shimPeerConnection=function shimPeerConnection(e){var t=s.detectBrowser(e);!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection);if(!e.RTCPeerConnection)return;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function addIceCandidate(){return arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},r.fixNegotiationNeeded=function fixNegotiationNeeded(e){s.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if("stable"===t.signalingState)return e})};var s=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function shimAddTrackRemoveTrackWithNative(e){e.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function addTrack(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function addStream(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function removeStream(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function removeTrack(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}},{"../utils.js":99,"./getdisplaymedia":88,"./getusermedia":89}],88:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function shimGetDisplayMedia(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function getDisplayMedia(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})}}},{}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function shimGetUserMedia(e){var t=e&&e.navigator;if(!t.mediaDevices)return;var r=i.detectBrowser(e),s=function constraintsToChrome_(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function oldname_(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var s={};"number"==typeof i.ideal?(s[o("min",r)]=i.ideal,t.optional.push(s),(s={})[o("max",r)]=i.ideal,t.optional.push(s)):(s[o("",r)]=i.ideal,t.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function shimConstraints_(e,i){if(r.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var a=function remap(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var u=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||u)){delete e.video.facingMode;var d=void 0;if("environment"===c.exact||"environment"===c.ideal?d=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return d.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&d.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=s(e.video),o("chrome: "+JSON.stringify(e)),i(e)})}e.video=s(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function shimError_(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function getUserMedia_(e,r,n){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){n&&n(c(e))})})}.bind(t),t.mediaDevices.getUserMedia){var u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}};var i=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));var o=i.log},{"../utils.js":99}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function shimRTCIceCandidate(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;var t=e.RTCIceCandidate;e.RTCIceCandidate=function RTCIceCandidate(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),o=i.default.parseCandidate(e.candidate),s=Object.assign(r,o);return s.toJSON=function toJSON(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})},r.shimMaxMessageSize=function shimMaxMessageSize(e){if(!e.RTCPeerConnection)return;var t=o.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function get(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),n=e.sdpSemantics;"plan-b"===n&&Object.defineProperty(this,"sctp",{get:function get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function sctpInDescription(e){if(!e||!e.sdp)return!1;var t=i.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=i.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var o=function getRemoteFirefoxVersion(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),s=function getCanSendMaxMessageSize(e){var r=65536;"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637);return r}(o),a=function getMaxMessageSize(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var o=i.default.matchPrefix(e.sdp,"a=max-message-size:");o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637);return n}(arguments[0],o),c=void 0;c=0===s&&0===a?Number.POSITIVE_INFINITY:0===s||0===a?Math.max(s,a):Math.min(s,a);var u={};Object.defineProperty(u,"maxMessageSize",{get:function get(){return c}}),this._sctp=u}return r.apply(this,arguments)}},r.shimSendThrowTypeError=function shimSendThrowTypeError(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function wrapDcSend(e,t){var r=e.send;e.send=function send(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function createDataChannel(){var e=t.apply(this,arguments);return wrapDcSend(e,this),e},o.wrapPeerConnectionEvent(e,"datachannel",function(e){return wrapDcSend(e.channel,e.target),e})},r.shimConnectionState=function shimConnectionState(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function get(){return this._onconnectionstatechange||null},set:function set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})},r.removeAllowExtmapMixed=function removeAllowExtmapMixed(e){if(!e.RTCPeerConnection)return;var t=o.detectBrowser(e);if("chrome"===t.browser&&t.version>=71)return;var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}};var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(e("sdp")),o=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":99,sdp:58}],91:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function get(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function get(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function shimPeerConnection(e){var t=o.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function RTCIceCandidate(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function RTCSessionDescription(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function set(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,a.default)(e,t.version);e.RTCPeerConnection=function RTCPeerConnection(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),o.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},r.shimReplaceTrack=function shimReplaceTrack(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),s=e("./filtericeservers"),a=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(e("rtcpeerconnection-shim"))},{"../utils":99,"./filtericeservers":92,"./getdisplaymedia":93,"./getusermedia":94,"rtcpeerconnection-shim":57}],92:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function filterIceServers(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=i?t[0]:t,!!t.length}})};var n=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":99}],93:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function shimGetDisplayMedia(e){if(!("getDisplayMedia"in e.navigator))return;if(!e.navigator.mediaDevices)return;if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},{}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function shimGetUserMedia(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function shimError_(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function toString(){return this.name}}}(e))})}}},{}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function get(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function get(){return o.shimGetDisplayMedia}}),r.shimOnTrack=function shimOnTrack(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function get(){return{receiver:this.receiver}}})},r.shimPeerConnection=function shimPeerConnection(e){var t=s.detectBrowser(e);if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection);t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=function _defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});if(t.version<68){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function addIceCandidate(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function getStats(){var e=Array.prototype.slice.call(arguments),r=e[0],n=e[1],s=e[2];return o.apply(this,[r||null]).then(function(e){if(t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,s)}},r.shimSenderGetStats=function shimSenderGetStats(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function getSenders(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function addTrack(){var e=r.apply(this,arguments);return e._pc=this,e});e.RTCRtpSender.prototype.getStats=function getStats(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},r.shimReceiverGetStats=function shimReceiverGetStats(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function getReceivers(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function getStats(){return this._pc.getStats(this.track)}},r.shimRemoveStream=function shimRemoveStream(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function removeStream(e){var t=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})}},r.shimRTCDataChannel=function shimRTCDataChannel(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function shimAddTransceiver(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function addTransceiver(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();"encodings"in o||(o.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).catch(function(){})))}return n})},r.shimCreateOffer=function shimCreateOffer(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function createOffer(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}},r.shimCreateAnswer=function shimCreateAnswer(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function createAnswer(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}};var s=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":99,"./getdisplaymedia":96,"./getusermedia":97}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function shimGetDisplayMedia(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=function getDisplayMedia(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)}}},{}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function shimGetUserMedia(e){var t=i.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function remap(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","mozAutoGainControl"),s(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var e=c.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var u=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),s(e,"autoGainControl","mozAutoGainControl"),s(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}};var i=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":99}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function shimLocalStreamsAPI(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function addStream(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(n){return t.call(r,n,e)}),e.getVideoTracks().forEach(function(n){return t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function addTrack(e){var r=arguments[1];return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function removeStream(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})},r.shimRemoteStreamsAPI=function shimRemoteStreamsAPI(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function getRemoteStreams(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function get(){return this._onaddstream},set:function set(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function shimCallbacksAPI(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function createOffer(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function createAnswer(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var c=function withCallback(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function withCallback(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function withCallback(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c},r.shimGetUserMedia=function shimGetUserMedia(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(shimConstraints(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function getUserMedia(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))},r.shimConstraints=shimConstraints,r.shimRTCIceServerUrls=function shimRTCIceServerUrls(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function RTCPeerConnection(e,r){if(e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,n.push(s)):n.push(e.iceServers[o])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function get(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function shimTrackEventTransceiver(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function get(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function shimCreateOfferLegacy(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function createOffer(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}};var i=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function shimConstraints(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":99}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=extractVersion,r.wrapPeerConnectionEvent=function wrapPeerConnectionEvent(e,t,r){if(!e.RTCPeerConnection)return;var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function wrappedCallback(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function get(){return this["_on"+t]},set:function set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})},r.disableLog=function disableLog(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.");return i=e,e?"adapter.js logging disabled":"adapter.js logging enabled"},r.disableWarnings=function disableWarnings(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.");return o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")},r.log=function log(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function deprecated(e,t){if(!o)return;console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function detectBrowser(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r},r.compactObject=function compactObject(e){if(!isObject(e))return e;return Object.keys(e).reduce(function(t,r){var n=isObject(e[r]),i=n?compactObject(e[r]):e[r],o=n&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,function _defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},r,i))},{})},r.walkStats=walkStats,r.filterStats=function filterStats(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&walkStats(e,r,i)})}),i};var i=!0,o=!0;function extractVersion(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function walkStats(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?walkStats(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){walkStats(e,e.get(t),r)})}))}},{}],100:[function(e,t,r){function WildEmitter(){}t.exports=WildEmitter,WildEmitter.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,i=n?arguments[1]:void 0,o=n?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,r){var n=this,i=3===arguments.length,o=i?arguments[1]:void 0,s=i?arguments[2]:arguments[1];return this.on(e,o,function on(){n.off(e,on),s.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,r,n,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=0,n=(i=this.callbacks[t]).length;r<n;r++)i[r]._groupName===e&&(i.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(r=n.indexOf(t),n.splice(r,1),0===n.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,i=[].slice.call(arguments,1),o=this.callbacks[e],s=this.getWildcardCallbacks(e);if(o)for(t=0,r=(n=o.slice()).length;t<r&&n[t];++t)n[t].apply(this,i);if(s)for(r=s.length,t=0,r=(n=s.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split("*"),("*"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},WildEmitter.mixin(WildEmitter)},{}],101:[function(e,t,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,c=0;function encode(e){var t="";do{t=i[e%o]+t,e=Math.floor(e/o)}while(e>0);return t}function yeast(){var e=encode(+new Date);return e!==n?(a=0,n=e):e+"."+encode(a++)}for(;c<o;c++)s[i[c]]=c;yeast.encode=encode,yeast.decode=function decode(e){var t=0;for(c=0;c<e.length;c++)t=t*o+s[e.charAt(c)];return t},t.exports=yeast},{}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,25,24,26,27,28]);